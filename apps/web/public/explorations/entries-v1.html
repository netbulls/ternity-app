<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ternity — Entries Page Exploration</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="themes.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #111; color: #ccc;
            font-family: 'Inter', system-ui, sans-serif;
            padding: 20px; font-size: 14px;
        }

        /* Page header */
        .page-header { text-align: center; margin-bottom: 10px; }
        .page-header h1 {
            font-family: 'Oxanium', sans-serif;
            font-size: 11px; font-weight: 400;
            letter-spacing: 5px; text-transform: uppercase;
            color: rgba(255,255,255,0.3);
        }
        .page-header p { font-size: 11px; color: rgba(255,255,255,0.15); margin-top: 4px; }

        /* Switchers */
        .switcher-row {
            display: flex; justify-content: center; gap: 24px;
            margin-bottom: 16px; flex-wrap: wrap; align-items: center;
        }
        .switcher-label {
            font-size: 9px; letter-spacing: 1px; text-transform: uppercase;
            color: rgba(255,255,255,0.2);
        }
        .switcher-group { display: flex; gap: 4px; }
        .theme-nav { display: contents; }
        .switcher-group button {
            font-family: 'Inter', sans-serif; font-size: 10px;
            padding: 4px 10px; border-radius: 4px;
            border: 1px solid #222; background: #161616;
            color: rgba(255,255,255,0.35); cursor: pointer; transition: all 0.15s;
        }
        .switcher-group button:hover { border-color: #444; }
        .switcher-group button.active {
            background: #333; border-color: #555; color: rgba(255,255,255,0.8);
        }

        /* Scale */
        [data-scale="compact"] { --t-scale: 0.9; }
        [data-scale="default"] { --t-scale: 1.1; }
        [data-scale="comfortable"] { --t-scale: 1.2; }

        /* Section dividers */
        .section {
            max-width: 1200px; margin: 0 auto 40px;
            padding-top: 24px; border-top: 1px solid rgba(255,255,255,0.06);
        }
        .section-title {
            font-family: 'Oxanium', sans-serif; font-size: 13px; font-weight: 600;
            letter-spacing: 4px; text-transform: uppercase;
            color: rgba(255,255,255,0.5); margin-bottom: 6px;
        }
        .section-desc {
            font-size: 11px; color: rgba(255,255,255,0.15); margin-bottom: 20px;
        }
        .option-label {
            font-family: 'Oxanium', sans-serif; font-size: 12px; font-weight: 600;
            letter-spacing: 2px; text-transform: uppercase;
            color: rgba(255,255,255,0.55); margin-bottom: 12px; margin-top: 24px;
        }
        .option-label:first-child { margin-top: 0; }

        /* Theme container */
        .theme-container {
            max-width: 1200px; margin: 0 auto;
            border-radius: 16px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.06);
        }

        /* App layout */
        .app {
            background: hsl(var(--background)); color: hsl(var(--foreground));
            font-family: 'Inter', system-ui, sans-serif;
            font-size: calc(14px * var(--t-scale, 1));
            min-height: 800px; display: grid;
            grid-template-columns: 220px 1fr;
        }

        /* Sidebar */
        .sidebar {
            background: hsl(var(--sidebar-background));
            border-right: 1px solid hsl(var(--sidebar-border));
            padding: 20px 12px; display: flex; flex-direction: column; gap: 2px;
        }
        .sidebar .logo {
            font-family: 'Oxanium', sans-serif; font-weight: 600; font-size: 15px;
            letter-spacing: 3px; text-transform: uppercase;
            color: hsl(var(--sidebar-foreground));
            display: flex; align-items: center; gap: 8px;
            padding: 0 10px; margin-bottom: 20px;
        }
        .sidebar .logo svg { width: 18px; height: 22px; }
        .sidebar .nav-section {
            font-family: 'Oxanium', sans-serif;
            font-size: calc(9px * var(--t-scale, 1)); letter-spacing: 2px; text-transform: uppercase;
            color: hsl(var(--muted-foreground)); opacity: 0.5;
            padding: 12px 10px 4px; margin-top: 4px;
        }
        .sidebar .nav-item {
            font-size: calc(13px * var(--t-scale, 1)); padding: 8px 10px;
            border-radius: calc(var(--radius) - 2px);
            color: hsl(var(--muted-foreground)); cursor: default; transition: background 0.1s;
            display: flex; align-items: center; gap: 8px;
        }
        .sidebar .nav-item:hover {
            background: hsl(var(--sidebar-accent)); color: hsl(var(--sidebar-accent-foreground));
        }
        .sidebar .nav-item.active {
            background: hsl(var(--sidebar-accent)); color: hsl(var(--sidebar-accent-foreground));
            font-weight: 600;
        }
        .sidebar .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; }
        .sidebar .spacer { flex: 1; }
        .sidebar .user-block {
            display: flex; align-items: center; gap: 8px; padding: 10px;
            border-radius: calc(var(--radius)); background: hsl(var(--muted) / 0.5);
        }
        .sidebar .avatar {
            width: 30px; height: 30px; border-radius: 50%;
            background: hsl(var(--t-avatar-bg)); color: hsl(var(--t-avatar-text));
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: 600;
        }
        .sidebar .user-name { font-size: 12px; font-weight: 500; color: hsl(var(--sidebar-foreground)); }
        .sidebar .user-role { font-size: 10px; color: hsl(var(--muted-foreground)); }

        /* Main */
        .main { padding: 24px; overflow: auto; }

        .page-title {
            font-family: 'Oxanium', sans-serif; font-size: calc(18px * var(--t-scale, 1)); font-weight: 600;
            letter-spacing: 1px; color: hsl(var(--foreground));
        }
        .page-subtitle {
            font-size: calc(12px * var(--t-scale, 1)); color: hsl(var(--muted-foreground)); margin-top: 2px;
        }

        /* ============================================================
           WEEK HISTOGRAM
           ============================================================ */
        .histogram-card {
            background: hsl(var(--card)); border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) + 2px); padding: 16px 20px;
            margin-bottom: 16px;
        }
        .histogram-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 12px;
        }
        .histogram-title {
            font-family: 'Oxanium', sans-serif; font-size: calc(10px * var(--t-scale, 1));
            letter-spacing: 2px; text-transform: uppercase;
            color: hsl(var(--muted-foreground));
        }
        .histogram-total {
            font-family: 'Oxanium', sans-serif; font-size: calc(16px * var(--t-scale, 1));
            font-weight: 700; color: hsl(var(--primary));
        }
        .histogram-total .total-label {
            font-size: calc(10px * var(--t-scale, 1)); font-weight: 400;
            color: hsl(var(--muted-foreground)); letter-spacing: 1px;
            margin-right: 8px;
        }

        /* d3 chart styles */
        .chart-bar { transition: opacity 0.15s; cursor: default; }
        .chart-bar:hover { opacity: 0.8; }
        .chart-label {
            font-family: 'Oxanium', sans-serif;
            fill: hsl(var(--muted-foreground));
        }
        .chart-value {
            font-family: 'Oxanium', sans-serif;
            fill: hsl(var(--foreground));
        }
        .chart-grid-line {
            stroke: hsl(var(--border));
            stroke-dasharray: 2 4;
        }
        .chart-target-line {
            stroke: hsl(var(--destructive));
            stroke-dasharray: 4 4;
            stroke-width: 1;
            opacity: 0.4;
        }
        .chart-target-label {
            font-family: 'Inter', sans-serif;
            fill: hsl(var(--destructive));
            opacity: 0.5;
        }
        .chart-today .chart-bar { opacity: 1; }
        .chart-weekend .chart-bar { opacity: 0.4; }

        /* ============================================================
           MONTHLY HEATMAP
           ============================================================ */
        .heatmap-card {
            background: hsl(var(--card)); border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) + 2px); padding: 16px 20px;
            margin-bottom: 16px;
        }
        .heatmap-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 12px;
        }
        .heatmap-title {
            font-family: 'Oxanium', sans-serif; font-size: calc(10px * var(--t-scale, 1));
            letter-spacing: 2px; text-transform: uppercase;
            color: hsl(var(--muted-foreground));
        }
        .heatmap-legend {
            display: flex; align-items: center; gap: 4px;
            font-size: calc(9px * var(--t-scale, 1)); color: hsl(var(--muted-foreground));
        }
        .heatmap-legend-box {
            width: 10px; height: 10px; border-radius: 2px;
        }
        .heatmap-day {
            rx: 2; ry: 2; transition: opacity 0.15s; cursor: default;
        }
        .heatmap-day:hover { stroke: hsl(var(--foreground)); stroke-width: 1; }
        .heatmap-day-label {
            font-family: 'Oxanium', sans-serif;
            fill: hsl(var(--muted-foreground));
            font-size: 9px;
        }
        .heatmap-week-label {
            font-family: 'Oxanium', sans-serif;
            fill: hsl(var(--muted-foreground));
            font-size: 9px;
        }

        /* ============================================================
           DATE NAVIGATION
           ============================================================ */
        .nav-bar {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 16px; flex-wrap: wrap;
        }
        .view-toggle {
            display: flex; border-radius: calc(var(--radius)); overflow: hidden;
            border: 1px solid hsl(var(--border));
        }
        .view-toggle button {
            font-family: 'Inter', sans-serif; font-size: calc(12px * var(--t-scale, 1));
            padding: 6px 14px; border: none; background: transparent;
            color: hsl(var(--muted-foreground)); cursor: pointer; transition: all 0.15s;
        }
        .view-toggle button.active {
            background: hsl(var(--primary)); color: hsl(var(--primary-foreground));
        }
        .date-nav {
            display: flex; align-items: center; gap: 4px;
        }
        .date-nav button {
            padding: 6px; border-radius: calc(var(--radius) - 2px);
            border: none; background: transparent; color: hsl(var(--muted-foreground));
            cursor: pointer; display: flex; align-items: center;
        }
        .date-nav button:hover { background: hsl(var(--accent)); color: hsl(var(--foreground)); }
        .date-label {
            font-size: calc(12px * var(--t-scale, 1)); font-weight: 500;
            color: hsl(var(--foreground)); padding: 6px 12px;
            border-radius: calc(var(--radius) - 2px);
            display: flex; align-items: center; gap: 6px;
        }
        .date-label.today { background: hsl(var(--primary) / 0.1); color: hsl(var(--primary)); }
        .date-label svg { width: 14px; height: 14px; }

        .nav-spacer { flex: 1; }

        .period-total {
            display: flex; align-items: center; gap: 8px;
        }
        .period-total-label {
            font-family: 'Oxanium', sans-serif; font-size: calc(10px * var(--t-scale, 1));
            letter-spacing: 2px; text-transform: uppercase; color: hsl(var(--muted-foreground));
        }
        .period-total-value {
            font-family: 'Oxanium', sans-serif; font-size: calc(14px * var(--t-scale, 1));
            font-weight: 600; color: hsl(var(--foreground));
            font-variant-numeric: tabular-nums;
        }

        /* ============================================================
           HOUSEKEEPING BANNER
           ============================================================ */
        .housekeeping-banner {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 14px; margin-bottom: 12px;
            border-radius: calc(var(--radius)); background: hsl(35 100% 60% / 0.08);
            border: 1px solid hsl(35 100% 60% / 0.15);
        }
        .housekeeping-banner svg { width: 16px; height: 16px; color: hsl(35, 100%, 60%); flex-shrink: 0; }
        .housekeeping-banner .hk-text {
            font-size: calc(12px * var(--t-scale, 1)); color: hsl(var(--foreground));
        }
        .housekeeping-banner .hk-count {
            font-family: 'Oxanium', sans-serif; font-weight: 600;
            color: hsl(35, 100%, 60%);
        }
        .housekeeping-banner .hk-action {
            margin-left: auto; font-size: calc(11px * var(--t-scale, 1));
            color: hsl(var(--primary)); cursor: pointer; white-space: nowrap;
            text-decoration: underline; text-underline-offset: 2px;
        }

        /* Alt: pill-style housekeeping */
        .housekeeping-pill {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 10px; border-radius: 9999px;
            background: hsl(35 100% 60% / 0.1); border: 1px solid hsl(35 100% 60% / 0.2);
            font-size: calc(11px * var(--t-scale, 1)); color: hsl(35, 100%, 60%);
            cursor: pointer; transition: all 0.15s;
        }
        .housekeeping-pill:hover { background: hsl(35 100% 60% / 0.15); }
        .housekeeping-pill svg { width: 12px; height: 12px; }
        .housekeeping-pill .pill-count {
            font-family: 'Oxanium', sans-serif; font-weight: 700;
        }

        /* ============================================================
           DAY GROUP
           ============================================================ */
        .day-group { margin-bottom: 16px; }
        .day-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 0; margin-bottom: 4px;
        }
        .day-date {
            font-size: calc(12px * var(--t-scale, 1)); font-weight: 600;
            color: hsl(var(--foreground));
        }
        .day-total {
            font-family: 'Oxanium', sans-serif; font-size: calc(12px * var(--t-scale, 1));
            font-weight: 600; color: hsl(var(--foreground));
            font-variant-numeric: tabular-nums;
        }
        .day-entries {
            border: 1px solid hsl(var(--border)); border-radius: calc(var(--radius));
            overflow: hidden;
        }

        /* ============================================================
           ENTRY ROW
           ============================================================ */
        .entry-row {
            display: grid; grid-template-columns: 1fr auto auto auto;
            align-items: center; gap: 12px;
            padding: 10px 14px;
            border-bottom: 1px solid hsl(var(--border) / 0.5);
            transition: background 0.1s;
        }
        .entry-row:last-child { border-bottom: none; }
        .entry-row:hover { background: hsl(var(--muted) / 0.3); }

        /* Running entry */
        .entry-row.running {
            background: hsl(var(--t-timer-bg));
            border-left: 2px solid hsl(var(--primary));
        }

        /* No-project warning */
        .entry-row.no-project {
            border-left: 2px solid hsl(35, 100%, 60%);
        }

        .entry-desc {
            font-size: calc(13px * var(--t-scale, 1)); color: hsl(var(--foreground));
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .entry-desc.empty {
            color: hsl(var(--muted-foreground)); font-style: italic; opacity: 0.5;
        }

        .entry-project {
            display: flex; align-items: center; gap: 6px;
            font-size: calc(11px * var(--t-scale, 1));
        }
        .project-dot {
            width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
        }
        .project-name { color: hsl(var(--foreground)); font-weight: 500; }
        .client-name { color: hsl(var(--muted-foreground)); }
        .client-sep { color: hsl(var(--muted-foreground)); opacity: 0.4; }

        .no-project-badge {
            display: inline-flex; align-items: center; gap: 4px;
            font-size: calc(10px * var(--t-scale, 1)); color: hsl(35, 100%, 60%);
            background: hsl(35 100% 60% / 0.1); padding: 2px 8px; border-radius: 9999px;
            cursor: pointer;
        }
        .no-project-badge svg { width: 10px; height: 10px; }

        .entry-time {
            font-size: calc(11px * var(--t-scale, 1)); color: hsl(var(--muted-foreground));
            font-variant-numeric: tabular-nums; white-space: nowrap;
        }

        .entry-duration {
            font-family: 'Oxanium', sans-serif; font-size: calc(13px * var(--t-scale, 1));
            font-weight: 600; color: hsl(var(--foreground));
            font-variant-numeric: tabular-nums; min-width: 52px; text-align: right;
        }
        .entry-duration.running { color: hsl(var(--primary)); }

        .entry-actions {
            display: flex; align-items: center;
        }
        .entry-actions button {
            width: 28px; height: 28px; border-radius: calc(var(--radius) - 2px);
            border: none; background: transparent; color: hsl(var(--muted-foreground));
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.15s;
        }
        .entry-actions button:hover { background: hsl(var(--muted) / 0.5); color: hsl(var(--foreground)); }
        .entry-actions svg { width: 16px; height: 16px; }

        /* ============================================================
           INLINE EDITING STATES
           ============================================================ */
        .entry-row.editing {
            background: hsl(var(--muted) / 0.2);
        }
        .inline-edit-input {
            background: transparent; border: none; outline: none;
            font-family: 'Inter', sans-serif; font-size: calc(13px * var(--t-scale, 1));
            color: hsl(var(--foreground)); width: 100%;
            padding: 2px 0; border-bottom: 1px solid hsl(var(--primary));
        }
        .inline-edit-time {
            background: hsl(var(--muted) / 0.5); border: 1px solid hsl(var(--primary) / 0.3);
            border-radius: calc(var(--radius) - 2px);
            font-family: 'Inter', sans-serif; font-size: calc(11px * var(--t-scale, 1));
            color: hsl(var(--foreground)); padding: 3px 8px;
            font-variant-numeric: tabular-nums; width: 60px; text-align: center;
            outline: none;
        }
        .inline-edit-time:focus { border-color: hsl(var(--primary)); }

        /* Project picker inline */
        .project-picker-inline {
            position: relative;
        }
        .project-picker-dropdown {
            position: absolute; top: 100%; left: 0; margin-top: 4px;
            width: 260px; max-height: 240px; overflow-y: auto;
            background: hsl(var(--popover)); border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius)); box-shadow: 0 4px 16px hsl(var(--background) / 0.3);
            z-index: 20; padding: 4px;
        }
        .project-picker-search {
            width: calc(100% - 8px); margin: 4px; padding: 6px 10px;
            background: hsl(var(--muted) / 0.5); border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) - 2px); outline: none;
            font-family: 'Inter', sans-serif; font-size: calc(11px * var(--t-scale, 1));
            color: hsl(var(--foreground));
        }
        .project-picker-search::placeholder { color: hsl(var(--muted-foreground)); }
        .project-picker-client {
            font-size: calc(9px * var(--t-scale, 1)); font-weight: 600;
            letter-spacing: 1px; text-transform: uppercase;
            color: hsl(var(--muted-foreground)); padding: 8px 10px 4px; opacity: 0.6;
        }
        .project-picker-item {
            display: flex; align-items: center; gap: 8px;
            padding: 6px 10px; border-radius: calc(var(--radius) - 2px);
            cursor: pointer; transition: background 0.1s;
            font-size: calc(12px * var(--t-scale, 1)); color: hsl(var(--foreground));
        }
        .project-picker-item:hover { background: hsl(var(--accent)); }

        /* ============================================================
           ENTRY TIMELINE (AUDIT LOG)
           ============================================================ */
        .timeline-card {
            background: hsl(var(--card)); border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) + 2px); padding: 16px 20px;
        }
        .timeline-header {
            font-family: 'Oxanium', sans-serif; font-size: calc(10px * var(--t-scale, 1));
            letter-spacing: 2px; text-transform: uppercase;
            color: hsl(var(--muted-foreground)); margin-bottom: 16px;
        }
        .timeline {
            position: relative; padding-left: 24px;
        }
        .timeline::before {
            content: ''; position: absolute; left: 7px; top: 4px; bottom: 4px;
            width: 1px; background: hsl(var(--border));
        }
        .timeline-event {
            position: relative; margin-bottom: 16px;
        }
        .timeline-event:last-child { margin-bottom: 0; }
        .timeline-dot {
            position: absolute; left: -20px; top: 4px;
            width: 9px; height: 9px; border-radius: 50%;
            background: hsl(var(--border)); border: 2px solid hsl(var(--card));
        }
        .timeline-event.created .timeline-dot { background: hsl(var(--primary)); }
        .timeline-event.edited .timeline-dot { background: hsl(var(--chart-3)); }
        .timeline-event.deleted .timeline-dot { background: hsl(var(--destructive)); }

        .timeline-meta {
            font-size: calc(10px * var(--t-scale, 1)); color: hsl(var(--muted-foreground));
            margin-bottom: 2px;
        }
        .timeline-meta .timestamp { opacity: 0.6; }
        .timeline-action {
            font-size: calc(12px * var(--t-scale, 1)); color: hsl(var(--foreground));
        }
        .timeline-change {
            display: inline-flex; align-items: center; gap: 4px;
        }
        .timeline-old {
            text-decoration: line-through; color: hsl(var(--muted-foreground)); opacity: 0.5;
        }
        .timeline-arrow { color: hsl(var(--muted-foreground)); opacity: 0.4; }
        .timeline-new { color: hsl(var(--foreground)); font-weight: 500; }

        /* ============================================================
           FILTER BAR FOR PROJECT
           ============================================================ */
        .filter-bar {
            display: flex; align-items: center; gap: 8px; margin-bottom: 12px;
        }
        .filter-chip {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 5px 12px; border-radius: calc(var(--radius));
            border: 1px solid hsl(var(--border)); background: transparent;
            font-size: calc(12px * var(--t-scale, 1)); color: hsl(var(--muted-foreground));
            cursor: pointer; transition: all 0.15s;
        }
        .filter-chip:hover { border-color: hsl(var(--foreground)); color: hsl(var(--foreground)); }
        .filter-chip.active {
            border-color: hsl(var(--primary)); background: hsl(var(--primary) / 0.08);
            color: hsl(var(--primary));
        }
        .filter-chip svg { width: 14px; height: 14px; }

        /* ============================================================
           COMBINED OVERVIEW OPTIONS
           ============================================================ */
        .overview-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            margin-bottom: 16px;
        }
        .overview-grid.full { grid-template-columns: 1fr; }

        /* Stat pills inside histogram card */
        .stat-pills {
            display: flex; gap: 16px; margin-top: 12px;
            padding-top: 12px; border-top: 1px solid hsl(var(--border) / 0.5);
        }
        .stat-pill {
            display: flex; align-items: baseline; gap: 6px;
        }
        .stat-pill-label {
            font-family: 'Oxanium', sans-serif; font-size: calc(9px * var(--t-scale, 1));
            letter-spacing: 1.5px; text-transform: uppercase;
            color: hsl(var(--muted-foreground));
        }
        .stat-pill-value {
            font-family: 'Oxanium', sans-serif; font-size: calc(13px * var(--t-scale, 1));
            font-weight: 600; color: hsl(var(--foreground));
            font-variant-numeric: tabular-nums;
        }
        .stat-pill-value.accent { color: hsl(var(--primary)); }
        .stat-pill-value.warn { color: hsl(35, 100%, 60%); }

        /* manual entry button */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 6px;
            font-family: 'Inter', sans-serif; font-size: calc(12px * var(--t-scale, 1)); font-weight: 500;
            padding: 6px 12px; border-radius: calc(var(--radius));
            border: 1px solid hsl(var(--border)); background: transparent;
            color: hsl(var(--foreground)); cursor: pointer; transition: all 0.15s;
        }
        .btn:hover { background: hsl(var(--muted) / 0.3); }
        .btn svg { width: 14px; height: 14px; }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>Entries — Exploration</h1>
        <p>Layout, visualizations, inline editing, housekeeping indicators, audit timeline</p>
    </div>

    <!-- Theme / Scale switchers -->
    <div class="switcher-row">
        <span class="switcher-label">Theme</span>
        <div class="switcher-group theme-nav" id="themeNav"></div>
        <span class="switcher-label" style="margin-left: 12px;">Scale</span>
        <div class="switcher-group" id="scaleNav"></div>
    </div>

    <!-- ================================================================
         SECTION 1: WEEK HISTOGRAM OPTIONS
         ================================================================ -->
    <div class="section">
        <div class="section-title">1 · Week Histogram</div>
        <div class="section-desc">Hours per day — d3 bar chart. The primary "am I on track?" view.</div>

        <div class="option-label">1a — Bars with day labels, 8h target line</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="histogram-card">
                    <div class="histogram-header">
                        <span class="histogram-title">This Week</span>
                        <span class="histogram-total">
                            <span class="total-label">Total</span>34:15
                        </span>
                    </div>
                    <div id="histogram-a"></div>
                    <div class="stat-pills">
                        <div class="stat-pill">
                            <span class="stat-pill-label">Avg/day</span>
                            <span class="stat-pill-value">6:51</span>
                        </div>
                        <div class="stat-pill">
                            <span class="stat-pill-label">Target</span>
                            <span class="stat-pill-value" style="opacity: 0.5;">40:00</span>
                        </div>
                        <div class="stat-pill">
                            <span class="stat-pill-label">No project</span>
                            <span class="stat-pill-value warn">3</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="option-label">1b — Compact bars, no gridlines, stacked by project color</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="histogram-card">
                    <div class="histogram-header">
                        <span class="histogram-title">10 – 14 Feb 2026</span>
                        <span class="histogram-total">
                            <span class="total-label">Total</span>34:15
                        </span>
                    </div>
                    <div id="histogram-b"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================
         SECTION 2: MONTHLY HEATMAP OPTIONS
         ================================================================ -->
    <div class="section">
        <div class="section-title">2 · Monthly Heatmap</div>
        <div class="section-desc">Calendar view of the month — hours per day shown as color intensity. GitHub contribution graph style.</div>

        <div class="option-label">2a — Calendar grid with numbers</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="heatmap-card">
                    <div class="heatmap-header">
                        <span class="heatmap-title">February 2026</span>
                        <div class="heatmap-legend">
                            <span>Less</span>
                            <div class="heatmap-legend-box" style="background: hsl(var(--muted));"></div>
                            <div class="heatmap-legend-box" style="background: hsl(var(--primary) / 0.2);"></div>
                            <div class="heatmap-legend-box" style="background: hsl(var(--primary) / 0.4);"></div>
                            <div class="heatmap-legend-box" style="background: hsl(var(--primary) / 0.7);"></div>
                            <div class="heatmap-legend-box" style="background: hsl(var(--primary));"></div>
                            <span>More</span>
                        </div>
                    </div>
                    <div id="heatmap-a"></div>
                </div>
            </div>
        </div>

        <div class="option-label">2b — Compact row of squares (GitHub style), fits alongside histogram</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="overview-grid">
                    <div class="histogram-card" style="margin-bottom: 0;">
                        <div class="histogram-header">
                            <span class="histogram-title">This Week</span>
                            <span class="histogram-total"><span class="total-label">Total</span>34:15</span>
                        </div>
                        <div id="histogram-c"></div>
                    </div>
                    <div class="heatmap-card" style="margin-bottom: 0;">
                        <div class="heatmap-header">
                            <span class="heatmap-title">February 2026</span>
                            <span style="font-family: 'Oxanium', sans-serif; font-size: calc(13px * var(--t-scale, 1)); font-weight: 600; color: hsl(var(--foreground));">142:30</span>
                        </div>
                        <div id="heatmap-b"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================
         SECTION 3: HOUSEKEEPING INDICATORS
         ================================================================ -->
    <div class="section">
        <div class="section-title">3 · Housekeeping Indicators</div>
        <div class="section-desc">"You have entries without a project" — different ways to surface this.</div>

        <div class="option-label">3a — Banner above entries</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="housekeeping-banner">
                    <i data-lucide="alert-triangle"></i>
                    <span class="hk-text"><span class="hk-count">3 entries</span> this week have no project assigned</span>
                    <span class="hk-action">Show only unassigned →</span>
                </div>
            </div>
        </div>

        <div class="option-label">3b — Filter pill in the nav bar</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="filter-bar">
                    <div class="filter-chip active">
                        <i data-lucide="layers"></i> All entries
                    </div>
                    <div class="filter-chip">
                        <i data-lucide="alert-triangle"></i> No project <span style="font-family: 'Oxanium'; font-weight: 700; color: hsl(35, 100%, 60%);">3</span>
                    </div>
                    <div class="filter-chip">
                        <i data-lucide="folder"></i> Project
                    </div>
                </div>
            </div>
        </div>

        <div class="option-label">3c — Stat pill inside the overview card (see 1a)</div>
        <div class="section-desc" style="margin-bottom: 0; opacity: 0.5;">Already shown above in the stat pills row under the histogram — "No project: 3" in amber.</div>
    </div>

    <!-- ================================================================
         SECTION 4: ENTRY ROW LAYOUT
         ================================================================ -->
    <div class="section">
        <div class="section-title">4 · Entry Row Layout</div>
        <div class="section-desc">Client · Project display, times, duration. Various states. Single layout proposal.</div>

        <div class="theme-container" data-scale="default">
            <div class="app" data-theme="ternity-dark">
                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="logo">
                        <svg viewBox="0 0 18 22" fill="none"><path d="M9 0L0 4v6c0 6.6 3.84 12.74 9 14.4V22c5.16-1.66 9-7.8 9-14.4V4L9 0z" fill="currentColor" opacity="0.15"/><path d="M9 2L2 5.2v4.8c0 5.5 3 10.6 7 12V2z" fill="currentColor" opacity="0.3"/><rect x="5" y="6" width="2" height="10" rx="1" fill="currentColor"/><rect x="8" y="4" width="2" height="12" rx="1" fill="currentColor"/><rect x="11" y="8" width="2" height="8" rx="1" fill="currentColor"/></svg>
                        Ternity
                    </div>
                    <div class="nav-section">Tracking</div>
                    <div class="nav-item"><i data-lucide="timer"></i> Timer</div>
                    <div class="nav-item active"><i data-lucide="list"></i> Entries</div>
                    <div class="nav-item"><i data-lucide="bar-chart-2"></i> Reports</div>
                    <div class="nav-item"><i data-lucide="calendar"></i> Calendar</div>
                    <div class="nav-item"><i data-lucide="palm-tree"></i> Leave</div>
                    <div class="nav-section">Manage</div>
                    <div class="nav-item"><i data-lucide="folder"></i> Projects</div>
                    <div class="spacer"></div>
                    <div class="user-block">
                        <div class="avatar">EM</div>
                        <div>
                            <div class="user-name">Elena Marsh</div>
                            <div class="user-role">Developer</div>
                        </div>
                    </div>
                </div>

                <!-- Main content -->
                <div class="main">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                        <div>
                            <div class="page-title">Entries</div>
                            <div class="page-subtitle">Review and organize your time log</div>
                        </div>
                        <button class="btn"><i data-lucide="plus"></i> Manual Entry</button>
                    </div>

                    <!-- Nav bar -->
                    <div class="nav-bar">
                        <div class="view-toggle">
                            <button>Day</button>
                            <button class="active">Week</button>
                        </div>
                        <div class="date-nav">
                            <button><i data-lucide="chevron-left"></i></button>
                            <div class="date-label today"><i data-lucide="calendar"></i> 10 – 14 Feb 2026</div>
                            <button><i data-lucide="chevron-right"></i></button>
                        </div>

                        <div class="nav-spacer"></div>

                        <div class="housekeeping-pill">
                            <i data-lucide="alert-triangle"></i>
                            <span class="pill-count">3</span> no project
                        </div>

                        <div class="period-total">
                            <span class="period-total-label">Total</span>
                            <span class="period-total-value">34:15</span>
                        </div>
                    </div>

                    <!-- 4a: Day groups with entry rows -->
                    <div class="day-group">
                        <div class="day-header">
                            <span class="day-date">Friday, 14 Feb</span>
                            <span class="day-total">7:45</span>
                        </div>
                        <div class="day-entries">
                            <!-- 4a: Running entry -->
                            <div class="entry-row running" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">PROJ-347 Implement user notifications API</div>
                                    <div class="entry-project" style="margin-top: 3px;">
                                        <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                        <span class="client-name">Meridian Labs</span>
                                        <span class="client-sep">·</span>
                                        <span class="project-name">Platform Core</span>
                                    </div>
                                </div>
                                <div class="entry-time">14:20 – now</div>
                                <div class="entry-duration running">1:42</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>

                            <!-- 4b: Normal entry -->
                            <div class="entry-row" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">PROJ-341 Fix pagination edge case on reports</div>
                                    <div class="entry-project" style="margin-top: 3px;">
                                        <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                        <span class="client-name">Meridian Labs</span>
                                        <span class="client-sep">·</span>
                                        <span class="project-name">Platform Core</span>
                                    </div>
                                </div>
                                <div class="entry-time">11:00 – 14:15</div>
                                <div class="entry-duration">3:15</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>

                            <!-- 4c: Entry without project -->
                            <div class="entry-row no-project" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">Team standup + sprint planning</div>
                                    <div style="margin-top: 3px;">
                                        <span class="no-project-badge"><i data-lucide="alert-triangle"></i> No project</span>
                                    </div>
                                </div>
                                <div class="entry-time">09:00 – 10:45</div>
                                <div class="entry-duration">1:45</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>

                            <!-- 4d: Entry with different project/client -->
                            <div class="entry-row" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">Code review for onboarding flow PR</div>
                                    <div class="entry-project" style="margin-top: 3px;">
                                        <span class="project-dot" style="background: hsl(var(--t-project-2));"></span>
                                        <span class="client-name">Apex Digital</span>
                                        <span class="client-sep">·</span>
                                        <span class="project-name">E-commerce Rebuild</span>
                                    </div>
                                </div>
                                <div class="entry-time">08:00 – 09:00</div>
                                <div class="entry-duration">1:00</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>
                        </div>
                    </div>

                    <!-- Thursday -->
                    <div class="day-group">
                        <div class="day-header">
                            <span class="day-date">Thursday, 13 Feb</span>
                            <span class="day-total">8:15</span>
                        </div>
                        <div class="day-entries">
                            <div class="entry-row" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">PROJ-339 Database migration script for v2 schema</div>
                                    <div class="entry-project" style="margin-top: 3px;">
                                        <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                        <span class="client-name">Meridian Labs</span>
                                        <span class="client-sep">·</span>
                                        <span class="project-name">Platform Core</span>
                                    </div>
                                </div>
                                <div class="entry-time">13:00 – 17:30</div>
                                <div class="entry-duration">4:30</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>
                            <div class="entry-row no-project" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">Debugging production memory leak</div>
                                    <div style="margin-top: 3px;">
                                        <span class="no-project-badge"><i data-lucide="alert-triangle"></i> No project</span>
                                    </div>
                                </div>
                                <div class="entry-time">09:30 – 12:45</div>
                                <div class="entry-duration">3:15</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>
                            <!-- 4e: Entry with no description -->
                            <div class="entry-row" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc empty">(no description)</div>
                                    <div class="entry-project" style="margin-top: 3px;">
                                        <span class="project-dot" style="background: hsl(var(--t-project-3));"></span>
                                        <span class="client-name">Internal</span>
                                        <span class="client-sep">·</span>
                                        <span class="project-name">Team Ops</span>
                                    </div>
                                </div>
                                <div class="entry-time">09:00 – 09:30</div>
                                <div class="entry-duration">0:30</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>
                        </div>
                    </div>

                    <!-- Wednesday (lower hours) -->
                    <div class="day-group">
                        <div class="day-header">
                            <span class="day-date">Wednesday, 12 Feb</span>
                            <span class="day-total">4:30</span>
                        </div>
                        <div class="day-entries">
                            <div class="entry-row" style="grid-template-columns: 1fr auto auto auto auto;">
                                <div>
                                    <div class="entry-desc">PROJ-335 Refactor authentication middleware</div>
                                    <div class="entry-project" style="margin-top: 3px;">
                                        <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                        <span class="client-name">Meridian Labs</span>
                                        <span class="client-sep">·</span>
                                        <span class="project-name">Platform Core</span>
                                    </div>
                                </div>
                                <div class="entry-time">13:00 – 17:30</div>
                                <div class="entry-duration">4:30</div>
                                <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================
         SECTION 5: INLINE EDITING
         ================================================================ -->
    <div class="section">
        <div class="section-title">5 · Inline Editing States</div>
        <div class="section-desc">Click any field to edit in place. One field at a time.</div>

        <div class="option-label">5a — Description editing</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div style="border: 1px solid hsl(var(--border)); border-radius: var(--radius); overflow: hidden;">
                    <div class="entry-row editing" style="grid-template-columns: 1fr auto auto auto auto;">
                        <div>
                            <input class="inline-edit-input" value="PROJ-341 Fix pagination edge case on reports" />
                            <div class="entry-project" style="margin-top: 3px;">
                                <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                <span class="client-name">Meridian Labs</span>
                                <span class="client-sep">·</span>
                                <span class="project-name">Platform Core</span>
                            </div>
                        </div>
                        <div class="entry-time">11:00 – 14:15</div>
                        <div class="entry-duration">3:15</div>
                        <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="option-label">5b — Time editing</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div style="border: 1px solid hsl(var(--border)); border-radius: var(--radius); overflow: hidden;">
                    <div class="entry-row editing" style="grid-template-columns: 1fr auto auto auto auto;">
                        <div>
                            <div class="entry-desc">PROJ-341 Fix pagination edge case on reports</div>
                            <div class="entry-project" style="margin-top: 3px;">
                                <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                <span class="client-name">Meridian Labs</span>
                                <span class="client-sep">·</span>
                                <span class="project-name">Platform Core</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input class="inline-edit-time" value="11:00" />
                            <span style="color: hsl(var(--muted-foreground));">–</span>
                            <input class="inline-edit-time" value="14:15" />
                        </div>
                        <div class="entry-duration">3:15</div>
                        <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="option-label">5c — Project picker (inline dropdown)</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px; min-height: 320px;" data-theme="ternity-dark">
                <div style="border: 1px solid hsl(var(--border)); border-radius: var(--radius); overflow: visible;">
                    <div class="entry-row editing" style="grid-template-columns: 1fr auto auto auto auto; position: relative;">
                        <div>
                            <div class="entry-desc">Team standup + sprint planning</div>
                            <div class="project-picker-inline" style="margin-top: 3px;">
                                <span class="no-project-badge" style="border: 1px solid hsl(var(--primary)); background: hsl(var(--primary) / 0.05);">
                                    <i data-lucide="search"></i> Select project...
                                </span>
                                <div class="project-picker-dropdown">
                                    <input class="project-picker-search" placeholder="Search projects..." value="plat" />
                                    <div class="project-picker-client">Meridian Labs</div>
                                    <div class="project-picker-item">
                                        <span class="project-dot" style="background: hsl(var(--t-project-1));"></span>
                                        <strong style="font-weight: 500;">Plat</strong>form Core
                                    </div>
                                    <div class="project-picker-client">Apex Digital</div>
                                    <div class="project-picker-item">
                                        <span class="project-dot" style="background: hsl(var(--t-project-2));"></span>
                                        Data <strong style="font-weight: 500;">Plat</strong>form
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="entry-time">09:00 – 10:45</div>
                        <div class="entry-duration">1:45</div>
                        <div class="entry-actions"><button><i data-lucide="more-horizontal"></i></button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================
         SECTION 6: ENTRY AUDIT TIMELINE
         ================================================================ -->
    <div class="section">
        <div class="section-title">6 · Entry Audit Timeline</div>
        <div class="section-desc">Shopify-style activity log. Every edit is traceable. Could live in an expandable row or side panel.</div>

        <div class="option-label">6a — Edit history timeline</div>
        <div class="theme-container" data-scale="default">
            <div style="background: hsl(var(--background)); padding: 24px;" data-theme="ternity-dark">
                <div class="timeline-card">
                    <div class="timeline-header">Activity — "PROJ-341 Fix pagination edge case"</div>
                    <div class="timeline">
                        <div class="timeline-event edited">
                            <div class="timeline-dot"></div>
                            <div class="timeline-meta">Elena Marsh · <span class="timestamp">Today at 14:20</span></div>
                            <div class="timeline-action">
                                Changed project:
                                <span class="timeline-change">
                                    <span class="timeline-old">E-commerce Rebuild</span>
                                    <span class="timeline-arrow">→</span>
                                    <span class="timeline-new">Platform Core</span>
                                </span>
                            </div>
                        </div>
                        <div class="timeline-event edited">
                            <div class="timeline-dot"></div>
                            <div class="timeline-meta">Elena Marsh · <span class="timestamp">Today at 14:18</span></div>
                            <div class="timeline-action">
                                Changed stop time:
                                <span class="timeline-change">
                                    <span class="timeline-old">14:00</span>
                                    <span class="timeline-arrow">→</span>
                                    <span class="timeline-new">14:15</span>
                                </span>
                            </div>
                        </div>
                        <div class="timeline-event edited">
                            <div class="timeline-dot"></div>
                            <div class="timeline-meta">Elena Marsh · <span class="timestamp">Today at 11:05</span></div>
                            <div class="timeline-action">
                                Changed description:
                                <span class="timeline-change">
                                    <span class="timeline-old">Fix pagination</span>
                                    <span class="timeline-arrow">→</span>
                                    <span class="timeline-new">PROJ-341 Fix pagination edge case on reports</span>
                                </span>
                            </div>
                        </div>
                        <div class="timeline-event created">
                            <div class="timeline-dot"></div>
                            <div class="timeline-meta">Elena Marsh · <span class="timestamp">Today at 11:00</span></div>
                            <div class="timeline-action">
                                Created entry — started timer
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6b: Deleted entry example -->
                <div style="font-family: 'Oxanium', sans-serif; font-size: calc(9px * var(--t-scale, 1)); letter-spacing: 3px; text-transform: uppercase; color: hsl(var(--muted-foreground)); opacity: 0.5; margin-top: 20px; margin-bottom: 8px;">6b — Deleted entry timeline</div>
                <div class="timeline-card" style="opacity: 0.7;">
                    <div class="timeline-header" style="display: flex; align-items: center; gap: 8px;">
                        Activity — "Accidental duplicate"
                        <span style="font-family: 'Inter'; font-size: calc(10px * var(--t-scale, 1)); background: hsl(var(--destructive) / 0.12); color: hsl(var(--destructive)); padding: 2px 8px; border-radius: 9999px; letter-spacing: 0;">Deleted</span>
                    </div>
                    <div class="timeline">
                        <div class="timeline-event deleted">
                            <div class="timeline-dot"></div>
                            <div class="timeline-meta">Elena Marsh · <span class="timestamp">Today at 12:30</span></div>
                            <div class="timeline-action">Deleted entry</div>
                        </div>
                        <div class="timeline-event created">
                            <div class="timeline-dot"></div>
                            <div class="timeline-meta">Elena Marsh · <span class="timestamp">Today at 12:28</span></div>
                            <div class="timeline-action">Created entry — manual</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ================================================================
    // Theme / Scale switching
    // ================================================================
    const THEMES = [
        { id: 'ternity-dark', label: 'Ternity Dark' },
        { id: 'ternity-light', label: 'Ternity Light' },
        { id: 'midnight', label: 'Midnight' },
        { id: 'warm-sand', label: 'Warm Sand' },
        { id: 'carbon', label: 'Carbon' },
        { id: 'high-contrast', label: 'High Contrast' },
    ];
    const SCALES = [
        { id: 'compact', label: 'Compact' },
        { id: 'default', label: 'Default' },
        { id: 'comfortable', label: 'Comfortable' },
    ];

    let currentTheme = 'ternity-dark';
    let currentScale = 'default';

    function applyTheme(id) {
        currentTheme = id;
        document.querySelectorAll('[data-theme]').forEach(el => el.setAttribute('data-theme', id));
        document.querySelectorAll('#themeNav button').forEach(b => b.classList.toggle('active', b.dataset.id === id));
        renderAllCharts();
    }
    function applyScale(id) {
        currentScale = id;
        document.querySelectorAll('[data-scale]').forEach(el => el.setAttribute('data-scale', id));
        document.querySelectorAll('#scaleNav button').forEach(b => b.classList.toggle('active', b.dataset.id === id));
    }

    // Build switchers
    const themeNav = document.getElementById('themeNav');
    THEMES.forEach(t => {
        const btn = document.createElement('button');
        btn.textContent = t.label;
        btn.dataset.id = t.id;
        if (t.id === currentTheme) btn.classList.add('active');
        btn.onclick = () => applyTheme(t.id);
        themeNav.appendChild(btn);
    });
    const scaleNav = document.getElementById('scaleNav');
    SCALES.forEach(s => {
        const btn = document.createElement('button');
        btn.textContent = s.label;
        btn.dataset.id = s.id;
        if (s.id === currentScale) btn.classList.add('active');
        btn.onclick = () => applyScale(s.id);
        scaleNav.appendChild(btn);
    });

    // ================================================================
    // d3 Charts
    // ================================================================
    const WEEK_DATA = [
        { day: 'Mon', hours: 7.5, label: '7:30', weekend: false },
        { day: 'Tue', hours: 6.0, label: '6:00', weekend: false },
        { day: 'Wed', hours: 4.5, label: '4:30', weekend: false },
        { day: 'Thu', hours: 8.25, label: '8:15', weekend: false },
        { day: 'Fri', hours: 7.75, label: '7:45', weekend: false, today: true },
        { day: 'Sat', hours: 0.25, label: '0:15', weekend: true },
        { day: 'Sun', hours: 0, label: '—', weekend: true },
    ];

    // Project-stacked data for option B
    const WEEK_STACKED = [
        { day: 'Mon', projects: [{ hours: 5, color: 'var(--t-project-1)' }, { hours: 2, color: 'var(--t-project-2)' }, { hours: 0.5, color: 'var(--t-project-3)' }] },
        { day: 'Tue', projects: [{ hours: 4, color: 'var(--t-project-1)' }, { hours: 2, color: 'var(--t-project-2)' }] },
        { day: 'Wed', projects: [{ hours: 4.5, color: 'var(--t-project-1)' }] },
        { day: 'Thu', projects: [{ hours: 5, color: 'var(--t-project-1)' }, { hours: 3.25, color: 'var(--t-project-3)' }] },
        { day: 'Fri', projects: [{ hours: 4.5, color: 'var(--t-project-1)' }, { hours: 1, color: 'var(--t-project-2)' }, { hours: 2.25, color: 'var(--t-project-3)' }] },
        { day: 'Sat', projects: [{ hours: 0.25, color: 'var(--t-project-3)' }] },
        { day: 'Sun', projects: [] },
    ];

    // Feb 2026 heatmap data
    const FEB_DATA = [];
    for (let d = 1; d <= 28; d++) {
        const date = new Date(2026, 1, d);
        const dow = date.getDay();
        const isWeekend = dow === 0 || dow === 6;
        let hours = 0;
        if (!isWeekend) hours = 4 + Math.random() * 5;
        if (d > 14) hours = 0; // future
        if (isWeekend && Math.random() > 0.7) hours = Math.random() * 2;
        FEB_DATA.push({ day: d, date, dow, hours: Math.round(hours * 10) / 10, isWeekend });
    }

    function getCSS(varName) {
        // Read CSS variable from the first themed element
        const el = document.querySelector('[data-theme]');
        if (!el) return '#00D4AA';
        const val = getComputedStyle(el).getPropertyValue(varName).trim();
        if (!val) return '#00D4AA';
        return `hsl(${val})`;
    }

    function renderHistogramA() {
        const container = document.getElementById('histogram-a');
        container.innerHTML = '';
        const width = container.offsetWidth || 600;
        const height = 120;
        const margin = { top: 8, right: 10, bottom: 22, left: 0 };

        const svg = d3.select(container).append('svg')
            .attr('width', width).attr('height', height);

        const x = d3.scaleBand()
            .domain(WEEK_DATA.map(d => d.day))
            .range([margin.left, width - margin.right])
            .padding(0.35);

        const y = d3.scaleLinear()
            .domain([0, 10]).range([height - margin.bottom, margin.top]);

        // 8h target line
        svg.append('line')
            .attr('class', 'chart-target-line')
            .attr('x1', margin.left).attr('x2', width - margin.right)
            .attr('y1', y(8)).attr('y2', y(8));
        svg.append('text')
            .attr('class', 'chart-target-label')
            .attr('x', width - margin.right).attr('y', y(8) - 3)
            .attr('text-anchor', 'end').attr('font-size', '9px')
            .text('8h target');

        // Bars
        const primary = getCSS('--primary');
        const muted = getCSS('--muted-foreground');

        svg.selectAll('.bar-group')
            .data(WEEK_DATA).enter().append('g')
            .attr('class', d => `bar-group ${d.today ? 'chart-today' : ''} ${d.weekend ? 'chart-weekend' : ''}`)
            .each(function(d) {
                const g = d3.select(this);
                // Bar
                g.append('rect')
                    .attr('class', 'chart-bar')
                    .attr('x', x(d.day)).attr('width', x.bandwidth())
                    .attr('y', y(d.hours)).attr('height', Math.max(0, y(0) - y(d.hours)))
                    .attr('rx', 3).attr('ry', 3)
                    .attr('fill', primary);
                // Value label
                if (d.hours > 0) {
                    g.append('text').attr('class', 'chart-value')
                        .attr('x', x(d.day) + x.bandwidth() / 2)
                        .attr('y', y(d.hours) - 4)
                        .attr('text-anchor', 'middle').attr('font-size', '10px')
                        .attr('font-weight', '600')
                        .text(d.label);
                }
                // Day label
                g.append('text').attr('class', 'chart-label')
                    .attr('x', x(d.day) + x.bandwidth() / 2)
                    .attr('y', height - 4)
                    .attr('text-anchor', 'middle').attr('font-size', '10px')
                    .text(d.day);
            });
    }

    function renderHistogramB() {
        const container = document.getElementById('histogram-b');
        container.innerHTML = '';
        const width = container.offsetWidth || 600;
        const height = 80;
        const margin = { top: 4, right: 10, bottom: 22, left: 0 };

        const svg = d3.select(container).append('svg')
            .attr('width', width).attr('height', height);

        const x = d3.scaleBand()
            .domain(WEEK_STACKED.map(d => d.day))
            .range([margin.left, width - margin.right])
            .padding(0.4);

        const y = d3.scaleLinear()
            .domain([0, 10]).range([height - margin.bottom, margin.top]);

        svg.selectAll('.stack-group')
            .data(WEEK_STACKED).enter().append('g')
            .each(function(d) {
                const g = d3.select(this);
                let cumulative = 0;
                d.projects.forEach(p => {
                    g.append('rect')
                        .attr('class', 'chart-bar')
                        .attr('x', x(d.day)).attr('width', x.bandwidth())
                        .attr('y', y(cumulative + p.hours))
                        .attr('height', Math.max(0, y(cumulative) - y(cumulative + p.hours)))
                        .attr('rx', 2).attr('ry', 2)
                        .attr('fill', `hsl(${p.color})`);
                    cumulative += p.hours;
                });
                g.append('text').attr('class', 'chart-label')
                    .attr('x', x(d.day) + x.bandwidth() / 2)
                    .attr('y', height - 4)
                    .attr('text-anchor', 'middle').attr('font-size', '10px')
                    .text(d.day);
            });
    }

    function renderHistogramC() {
        const container = document.getElementById('histogram-c');
        if (!container) return;
        container.innerHTML = '';
        const width = container.offsetWidth || 400;
        const height = 80;
        const margin = { top: 4, right: 4, bottom: 22, left: 0 };

        const svg = d3.select(container).append('svg')
            .attr('width', width).attr('height', height);

        const primary = getCSS('--primary');
        const x = d3.scaleBand()
            .domain(WEEK_DATA.map(d => d.day))
            .range([margin.left, width - margin.right])
            .padding(0.35);
        const y = d3.scaleLinear()
            .domain([0, 10]).range([height - margin.bottom, margin.top]);

        svg.selectAll('.bar')
            .data(WEEK_DATA).enter().append('g')
            .each(function(d) {
                const g = d3.select(this);
                g.append('rect')
                    .attr('class', 'chart-bar')
                    .attr('x', x(d.day)).attr('width', x.bandwidth())
                    .attr('y', y(d.hours)).attr('height', Math.max(0, y(0) - y(d.hours)))
                    .attr('rx', 2).attr('fill', primary)
                    .attr('opacity', d.weekend ? 0.3 : 0.8);
                g.append('text').attr('class', 'chart-label')
                    .attr('x', x(d.day) + x.bandwidth() / 2)
                    .attr('y', height - 4)
                    .attr('text-anchor', 'middle').attr('font-size', '9px')
                    .text(d.day);
            });
    }

    function renderHeatmapA() {
        const container = document.getElementById('heatmap-a');
        container.innerHTML = '';
        const cellSize = 28;
        const cellGap = 3;
        const labelWidth = 30;
        const headerHeight = 20;

        // Calendar grid — 7 rows (Mon-Sun) × 4-5 cols
        const weeks = [];
        let currentWeek = [];
        FEB_DATA.forEach(d => {
            const dow = d.date.getDay();
            if (dow === 1 && currentWeek.length > 0) {
                weeks.push(currentWeek);
                currentWeek = [];
            }
            currentWeek.push(d);
        });
        if (currentWeek.length > 0) weeks.push(currentWeek);

        const width = labelWidth + weeks.length * (cellSize + cellGap) + 20;
        const height = headerHeight + 7 * (cellSize + cellGap);

        const svg = d3.select(container).append('svg')
            .attr('width', width).attr('height', height);

        const primary = getCSS('--primary');
        const mutedBg = getCSS('--muted');

        // Day labels
        ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].forEach((label, i) => {
            if (i % 2 === 0) {
                svg.append('text').attr('class', 'heatmap-day-label')
                    .attr('x', labelWidth - 6)
                    .attr('y', headerHeight + i * (cellSize + cellGap) + cellSize / 2 + 3)
                    .attr('text-anchor', 'end')
                    .text(label);
            }
        });

        // Cells
        weeks.forEach((week, wi) => {
            week.forEach(d => {
                const dow = d.date.getDay();
                const row = dow === 0 ? 6 : dow - 1; // Mon=0
                const opacity = d.hours === 0 ? 0 : Math.min(1, 0.15 + (d.hours / 10) * 0.85);
                const fill = d.hours === 0 ? mutedBg : primary;

                const rect = svg.append('rect')
                    .attr('class', 'heatmap-day')
                    .attr('x', labelWidth + wi * (cellSize + cellGap))
                    .attr('y', headerHeight + row * (cellSize + cellGap))
                    .attr('width', cellSize).attr('height', cellSize)
                    .attr('fill', fill)
                    .attr('opacity', d.hours === 0 ? 0.3 : opacity);

                // Hours number inside cell
                if (d.hours > 0) {
                    svg.append('text')
                        .attr('x', labelWidth + wi * (cellSize + cellGap) + cellSize / 2)
                        .attr('y', headerHeight + row * (cellSize + cellGap) + cellSize / 2 + 4)
                        .attr('text-anchor', 'middle')
                        .attr('font-family', "'Oxanium', sans-serif")
                        .attr('font-size', '9px').attr('font-weight', '600')
                        .attr('fill', 'hsl(var(--foreground))')
                        .attr('opacity', 0.9)
                        .text(d.hours.toFixed(0) + 'h');
                }
            });
        });
    }

    function renderHeatmapB() {
        const container = document.getElementById('heatmap-b');
        if (!container) return;
        container.innerHTML = '';
        const cellSize = 16;
        const cellGap = 2;

        const weeks = [];
        let currentWeek = [];
        FEB_DATA.forEach(d => {
            const dow = d.date.getDay();
            if (dow === 1 && currentWeek.length > 0) {
                weeks.push(currentWeek);
                currentWeek = [];
            }
            currentWeek.push(d);
        });
        if (currentWeek.length > 0) weeks.push(currentWeek);

        const width = weeks.length * (cellSize + cellGap) + 10;
        const height = 7 * (cellSize + cellGap);

        const svg = d3.select(container).append('svg')
            .attr('width', width).attr('height', height);

        const primary = getCSS('--primary');
        const mutedBg = getCSS('--muted');

        weeks.forEach((week, wi) => {
            week.forEach(d => {
                const dow = d.date.getDay();
                const row = dow === 0 ? 6 : dow - 1;
                const opacity = d.hours === 0 ? 0 : Math.min(1, 0.15 + (d.hours / 10) * 0.85);
                const fill = d.hours === 0 ? mutedBg : primary;

                svg.append('rect')
                    .attr('class', 'heatmap-day')
                    .attr('x', wi * (cellSize + cellGap))
                    .attr('y', row * (cellSize + cellGap))
                    .attr('width', cellSize).attr('height', cellSize)
                    .attr('fill', fill)
                    .attr('opacity', d.hours === 0 ? 0.3 : opacity);
            });
        });
    }

    function renderAllCharts() {
        setTimeout(() => {
            renderHistogramA();
            renderHistogramB();
            renderHistogramC();
            renderHeatmapA();
            renderHeatmapB();
        }, 50);
    }

    // Init
    lucide.createIcons();
    renderAllCharts();

    // Re-render on resize
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(renderAllCharts, 200);
    });
    </script>
</body>
</html>
