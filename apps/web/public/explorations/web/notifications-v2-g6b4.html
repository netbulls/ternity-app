<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notifications — V2 Channel First</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../themes.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #0a0a0a;
        color: #ccc;
        font-family: 'Inter', system-ui, sans-serif;
        padding: 16px;
        font-size: 14px;
      }

      .page-header {
        text-align: center;
        margin-bottom: 8px;
      }
      .page-header h1 {
        font-family: 'Oxanium', sans-serif;
        font-size: 11px;
        font-weight: 400;
        letter-spacing: 5px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.3);
      }
      .page-header p {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.15);
        margin-top: 4px;
      }

      .switcher-row {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-bottom: 12px;
        flex-wrap: wrap;
        align-items: center;
      }
      .switcher-label {
        font-size: 9px;
        letter-spacing: 1px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.2);
      }
      .switcher-group {
        display: flex;
        gap: 4px;
      }
      .theme-nav {
        display: contents;
      }
      .switcher-group button {
        font-family: 'Inter', sans-serif;
        font-size: 10px;
        padding: 4px 10px;
        border-radius: 4px;
        border: 1px solid #222;
        background: #161616;
        color: rgba(255, 255, 255, 0.35);
        cursor: pointer;
        transition: all 0.15s;
      }
      .switcher-group button:hover {
        border-color: #444;
      }
      .switcher-group button.active {
        background: #333;
        border-color: #555;
        color: rgba(255, 255, 255, 0.8);
      }

      /* ── App shell ── */
      .app-shell {
        display: flex;
        max-width: 1280px;
        margin: 0 auto;
        min-height: 720px;
        background: hsl(var(--background));
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid hsl(var(--border));
      }

      /* ── Sidebar ── */
      .sidebar {
        width: 220px;
        flex-shrink: 0;
        background: hsl(var(--sidebar-background));
        border-right: 1px solid hsl(var(--sidebar-border));
        display: flex;
        flex-direction: column;
        height: 720px;
        padding: 20px 12px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 10px;
        margin-bottom: 20px;
      }
      .logo-icon {
        width: 18px;
        height: 22px;
        color: hsl(var(--primary));
      }
      .logo-text {
        font-family: 'Oxanium', sans-serif;
        font-size: 15px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 3px;
      }

      .section-label {
        padding: 8px 10px 4px;
        font-family: 'Oxanium', sans-serif;
        text-transform: uppercase;
        color: hsl(var(--muted-foreground));
        opacity: 0.5;
        font-size: 10px;
        letter-spacing: 2px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 6px;
        color: hsl(var(--muted-foreground));
        font-size: 13px;
        cursor: pointer;
        transition: all 0.15s;
        text-decoration: none;
      }
      .nav-item:hover {
        background: hsl(var(--sidebar-accent));
        color: hsl(var(--sidebar-accent-foreground));
      }
      .nav-item i {
        width: 16px;
        height: 16px;
      }

      .sidebar-spacer {
        flex: 1;
      }

      .user-block {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.15s;
      }
      .user-block:hover {
        background: hsl(var(--muted) / 0.5);
      }
      .avatar {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: hsl(var(--t-avatar-bg));
        color: hsl(var(--t-avatar-text));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        flex-shrink: 0;
      }
      .user-info {
        flex: 1;
        min-width: 0;
      }
      .user-name {
        font-size: 12px;
        font-weight: 500;
        color: hsl(var(--sidebar-foreground));
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .user-org {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        margin-top: 1px;
        display: flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }
      .user-org .badge {
        font-family: 'Oxanium', sans-serif;
        font-size: 9px;
        font-weight: 600;
        letter-spacing: 0.5px;
        padding: 1px 5px;
        border-radius: 4px;
        background: hsl(var(--primary) / 0.12);
        color: hsl(var(--primary));
      }
      .user-chevrons {
        color: hsl(var(--muted-foreground));
        opacity: 0.5;
        flex-shrink: 0;
      }
      .user-chevrons i {
        width: 14px;
        height: 14px;
      }

      /* ── Main content ── */
      .main {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
      }

      .main-header {
        margin-bottom: 20px;
      }
      .main-title {
        font-family: 'Oxanium', sans-serif;
        font-size: 18px;
        font-weight: 600;
        color: hsl(var(--foreground));
      }
      .main-subtitle {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
        margin-top: 2px;
      }

      /* ── Tabs ── */
      .tabs {
        display: flex;
        gap: 0;
        border-bottom: 1px solid hsl(var(--border));
        margin-bottom: 28px;
        overflow-x: auto;
      }
      .tab {
        font-family: 'Inter', sans-serif;
        font-size: 13px;
        font-weight: 500;
        color: hsl(var(--muted-foreground));
        padding: 10px 16px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.15s;
        white-space: nowrap;
        background: none;
        border-top: none;
        border-left: none;
        border-right: none;
      }
      .tab:hover {
        color: hsl(var(--foreground));
      }
      .tab.active {
        color: hsl(var(--primary));
        border-bottom-color: hsl(var(--primary));
        font-weight: 600;
      }

      /* ── Notifications content ── */
      .content-area {
        max-width: 600px;
      }

      /* ── Channel Cards ── */
      .channel-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 28px;
      }

      .channel-card {
        background: hsl(var(--muted) / 0.3);
        border: 1px solid hsl(var(--border));
        border-radius: 10px;
        padding: 16px;
        transition: border-color 0.15s;
      }
      .channel-card.active {
        border-color: hsl(var(--primary) / 0.35);
      }

      .channel-card-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }
      .channel-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background: hsl(var(--primary) / 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .channel-icon i {
        width: 18px;
        height: 18px;
        color: hsl(var(--primary));
      }
      .channel-name {
        font-size: 14px;
        font-weight: 600;
        color: hsl(var(--foreground));
      }

      .channel-detail {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 14px;
        min-height: 20px;
        flex-wrap: wrap;
      }
      .channel-address {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .verified-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #22c55e;
        flex-shrink: 0;
      }
      .verified-text {
        font-size: 11px;
        color: #22c55e;
        font-weight: 500;
        flex-shrink: 0;
      }
      .send-test-link {
        font-size: 11px;
        color: hsl(var(--primary));
        cursor: pointer;
        border: none;
        background: none;
        font-family: 'Inter', sans-serif;
        text-decoration: underline;
        text-underline-offset: 2px;
        margin-left: 4px;
        flex-shrink: 0;
      }
      .send-test-link:hover {
        opacity: 0.8;
      }

      .channel-toggle-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .channel-toggle-label {
        font-size: 12px;
        color: hsl(var(--foreground));
      }

      /* ── Toggle switch ── */
      .toggle-switch {
        position: relative;
        width: 38px;
        height: 20px;
        flex-shrink: 0;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
        position: absolute;
      }
      .toggle-track {
        position: absolute;
        inset: 0;
        background: hsl(var(--muted-foreground) / 0.25);
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .toggle-track::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 16px;
        height: 16px;
        background: hsl(var(--foreground));
        border-radius: 50%;
        transition:
          transform 0.2s,
          background 0.2s;
      }
      .toggle-switch input:checked + .toggle-track {
        background: hsl(var(--primary));
      }
      .toggle-switch input:checked + .toggle-track::after {
        transform: translateX(18px);
        background: hsl(var(--primary-foreground));
      }
      .toggle-switch input:disabled + .toggle-track {
        opacity: 0.35;
        cursor: not-allowed;
      }

      /* ── Add phone flow ── */
      .add-phone-warning {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 14px;
        font-size: 11px;
        color: #f59e0b;
      }
      .add-phone-warning i {
        width: 14px;
        height: 14px;
        flex-shrink: 0;
      }

      .add-phone-btn {
        font-family: 'Inter', sans-serif;
        font-size: 12px;
        font-weight: 500;
        color: hsl(var(--primary));
        background: hsl(var(--primary) / 0.08);
        border: 1px dashed hsl(var(--primary) / 0.3);
        border-radius: 6px;
        padding: 6px 12px;
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        align-items: center;
        gap: 6px;
        width: 100%;
        justify-content: center;
        margin-bottom: 14px;
      }
      .add-phone-btn:hover {
        background: hsl(var(--primary) / 0.14);
        border-color: hsl(var(--primary) / 0.5);
      }
      .add-phone-btn i {
        width: 14px;
        height: 14px;
      }

      .phone-input-flow {
        display: none;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 14px;
      }
      .phone-input-flow.visible {
        display: flex;
      }
      .phone-input-row {
        display: flex;
        gap: 8px;
      }
      .phone-input {
        flex: 1;
        font-family: 'Oxanium', sans-serif;
        font-size: 13px;
        color: hsl(var(--foreground));
        background: hsl(var(--background));
        border: 1px solid hsl(var(--border));
        border-radius: 6px;
        padding: 7px 10px;
        outline: none;
        transition:
          border-color 0.15s,
          box-shadow 0.15s;
      }
      .phone-input:focus {
        border-color: hsl(var(--primary));
        box-shadow: 0 0 0 2px hsl(var(--primary) / 0.15);
      }
      .phone-verify-btn {
        font-family: 'Inter', sans-serif;
        font-size: 12px;
        font-weight: 600;
        padding: 7px 14px;
        border-radius: 6px;
        border: none;
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
        cursor: pointer;
        transition: opacity 0.15s;
        white-space: nowrap;
      }
      .phone-verify-btn:hover {
        opacity: 0.9;
      }
      .phone-cancel-btn {
        font-family: 'Inter', sans-serif;
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        background: none;
        border: none;
        cursor: pointer;
        align-self: flex-start;
      }
      .phone-cancel-btn:hover {
        color: hsl(var(--foreground));
      }

      /* ── Notification types matrix ── */
      .matrix-header {
        display: grid;
        grid-template-columns: 1fr 52px 52px 72px;
        gap: 8px;
        padding: 0 0 10px;
        margin-bottom: 4px;
        border-bottom: 1px solid hsl(var(--border));
      }
      .matrix-header-label {
        font-family: 'Oxanium', sans-serif;
        font-size: 10px;
        font-weight: 600;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: hsl(var(--muted-foreground));
        text-align: center;
      }
      .matrix-header-label:first-child {
        text-align: left;
      }

      .type-row {
        display: grid;
        grid-template-columns: 1fr 52px 52px 72px;
        gap: 8px;
        align-items: center;
        padding: 10px 0;
        transition: background 0.12s;
      }
      .type-row:hover {
        background: hsl(var(--muted) / 0.3);
        margin: 0 -8px;
        padding-left: 8px;
        padding-right: 8px;
        border-radius: 6px;
      }

      .type-divider {
        border: none;
        border-top: 1px solid hsl(var(--border) / 0.3);
        margin: 4px 0;
      }

      .type-info {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        min-width: 0;
      }
      .type-icon {
        width: 30px;
        height: 30px;
        border-radius: 6px;
        background: hsl(var(--muted));
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .type-icon i {
        width: 15px;
        height: 15px;
        color: hsl(var(--muted-foreground));
      }
      .type-icon.timer-type i {
        color: hsl(var(--chart-3));
      }
      .type-icon.leave-type i {
        color: hsl(var(--chart-2));
      }
      .type-icon.alert-type i {
        color: hsl(var(--destructive));
      }
      .type-icon.summary-type i {
        color: hsl(var(--primary));
      }

      .type-text {
        min-width: 0;
      }
      .type-name {
        font-size: 13px;
        font-weight: 500;
        color: hsl(var(--foreground));
        margin-bottom: 1px;
      }
      .type-desc {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        line-height: 1.3;
      }

      /* ── Mini toggle switch ── */
      .channel-check {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .mini-toggle {
        position: relative;
        width: 32px;
        height: 16px;
        flex-shrink: 0;
      }
      .mini-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
        position: absolute;
      }
      .mini-toggle-track {
        position: absolute;
        inset: 0;
        background: hsl(var(--muted-foreground) / 0.2);
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .mini-toggle-track::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 12px;
        height: 12px;
        background: hsl(var(--foreground) / 0.5);
        border-radius: 50%;
        transition:
          transform 0.2s,
          background 0.2s;
      }
      .mini-toggle input:checked + .mini-toggle-track {
        background: hsl(var(--primary));
      }
      .mini-toggle input:checked + .mini-toggle-track::after {
        transform: translateX(16px);
        background: hsl(var(--primary-foreground));
      }
      .mini-toggle input:disabled + .mini-toggle-track {
        opacity: 0.25;
        cursor: not-allowed;
      }

      .na-dash {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        opacity: 0.4;
        text-align: center;
      }

      /* ── Threshold dropdown ── */
      .threshold-cell {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .threshold-select {
        font-family: 'Oxanium', sans-serif;
        font-size: 11px;
        font-weight: 500;
        color: hsl(var(--foreground));
        background: hsl(var(--muted));
        border: 1px solid hsl(var(--border));
        border-radius: 5px;
        padding: 3px 6px;
        cursor: pointer;
        outline: none;
        transition: border-color 0.15s;
        -webkit-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23888' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 5px center;
        padding-right: 18px;
      }
      .threshold-select:focus {
        border-color: hsl(var(--primary));
      }
      .threshold-select:hover {
        border-color: hsl(var(--primary) / 0.5);
      }

      /* ── Responsive ── */
      @media (max-width: 540px) {
        .channel-cards {
          grid-template-columns: 1fr;
        }
        .matrix-header,
        .type-row {
          grid-template-columns: 1fr 44px 44px 60px;
        }
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <h1>Ternity</h1>
      <p>V2 — Channel First: Notifications settings organized by delivery channel</p>
    </div>
    <div class="switcher-row">
      <span class="switcher-label">Theme</span>
      <div class="switcher-group">
        <div class="theme-nav">
          <button class="active" onclick="setTheme('ternity-dark')">Ternity Dark</button>
          <button onclick="setTheme('ternity-light')">Ternity Light</button>
          <button onclick="setTheme('midnight')">Midnight</button>
          <button onclick="setTheme('warm-sand')">Warm Sand</button>
          <button onclick="setTheme('carbon')">Carbon</button>
          <button onclick="setTheme('high-contrast')">High Contrast</button>
        </div>
      </div>
    </div>

    <div class="app-shell" id="app" data-theme="ternity-dark">
      <!-- ── Sidebar ── -->
      <aside class="sidebar">
        <div class="logo">
          <i data-lucide="hourglass" class="logo-icon"></i>
          <span class="logo-text">Ternity</span>
        </div>

        <div class="section-label">Tracking</div>
        <a class="nav-item"><i data-lucide="sun"></i> My Day</a>
        <a class="nav-item"><i data-lucide="list"></i> Entries</a>
        <a class="nav-item"><i data-lucide="calendar"></i> Calendar</a>
        <a class="nav-item"><i data-lucide="palm-tree"></i> Leave</a>
        <a class="nav-item"><i data-lucide="bar-chart-3"></i> Reports</a>

        <div class="sidebar-spacer"></div>

        <div class="user-block">
          <div class="avatar">PR</div>
          <div class="user-info">
            <div class="user-name">Przemyslaw R.</div>
            <div class="user-org">
              Netbulls
              <span class="badge">Admin</span>
            </div>
          </div>
          <div class="user-chevrons">
            <i data-lucide="chevrons-up-down"></i>
          </div>
        </div>
      </aside>

      <!-- ── Main ── -->
      <main class="main">
        <div class="main-header">
          <h1 class="main-title">Settings</h1>
          <p class="main-subtitle">Manage your account and application preferences</p>
        </div>

        <div class="tabs">
          <button class="tab">General</button>
          <button class="tab">Appearance</button>
          <button class="tab">Integrations</button>
          <button class="tab">Downloads</button>
          <button class="tab">Tags</button>
          <button class="tab">Working Hours</button>
          <button class="tab active">Notifications</button>
        </div>

        <div class="content-area">
          <!-- ── Channel Cards ── -->
          <div class="channel-cards">
            <!-- Email card -->
            <div class="channel-card active" id="emailCard">
              <div class="channel-card-header">
                <div class="channel-icon"><i data-lucide="mail"></i></div>
                <div class="channel-name">Email</div>
              </div>
              <div class="channel-detail">
                <span class="channel-address">przemyslaw.rudzki@netbulls.io</span>
                <span class="verified-dot"></span>
                <span class="verified-text">Verified</span>
              </div>
              <div class="channel-toggle-row">
                <span class="channel-toggle-label">Enable email notifications</span>
                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    id="emailMaster"
                    checked
                    onchange="toggleChannel('email')"
                  />
                  <span class="toggle-track"></span>
                </label>
              </div>
            </div>

            <!-- SMS card -->
            <div class="channel-card" id="smsCard">
              <div class="channel-card-header">
                <div class="channel-icon"><i data-lucide="smartphone"></i></div>
                <div class="channel-name">SMS</div>
              </div>

              <!-- State: has phone -->
              <div class="channel-detail" id="smsHasPhone" style="display: none">
                <span class="channel-address"
                  >+48 &#8226;&#8226;&#8226; &#8226;&#8226;&#8226; 357</span
                >
                <span class="verified-dot"></span>
                <span class="verified-text">Verified</span>
                <button class="send-test-link" onclick="sendTest()">Send test</button>
              </div>

              <!-- State: no phone -->
              <div id="smsNoPhone">
                <div class="add-phone-warning" id="smsWarning">
                  <i data-lucide="triangle-alert"></i>
                  <span>No phone number on file</span>
                </div>
                <div id="smsAddBtn">
                  <button class="add-phone-btn" onclick="showPhoneInput()">
                    <i data-lucide="plus"></i> Add phone number
                  </button>
                </div>
                <div class="phone-input-flow" id="phoneInputFlow">
                  <div class="phone-input-row">
                    <input
                      type="tel"
                      class="phone-input"
                      id="phoneInput"
                      placeholder="+48 123 456 789"
                    />
                    <button class="phone-verify-btn" onclick="savePhone()">Verify</button>
                  </div>
                  <button class="phone-cancel-btn" onclick="cancelPhoneInput()">Cancel</button>
                </div>
              </div>

              <div class="channel-toggle-row">
                <span class="channel-toggle-label">Enable SMS notifications</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="smsMaster" disabled onchange="toggleChannel('sms')" />
                  <span class="toggle-track"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- ── Notification Types Matrix ── -->
          <div class="matrix-header">
            <div class="matrix-header-label"></div>
            <div class="matrix-header-label">Email</div>
            <div class="matrix-header-label">SMS</div>
            <div class="matrix-header-label">Threshold</div>
          </div>

          <div id="typesMatrix">
            <!-- Rows injected by JS -->
          </div>
        </div>
      </main>
    </div>

    <script>
      /* ── State ── */
      let phoneAdded = false;
      let emailEnabled = true;
      let smsEnabled = false;

      const TYPES = [
        {
          id: 'forgot-start',
          name: 'Forgot to start',
          desc: 'No timer after scheduled start',
          icon: 'clock',
          iconClass: 'timer-type',
          email: true,
          sms: false,
          hasSms: true,
          threshold: { options: ['15m', '30m', '45m', '60m'], selected: '15m' },
          group: 'timer',
        },
        {
          id: 'forgot-stop',
          name: 'Forgot to stop',
          desc: 'Timer running past scheduled end',
          icon: 'clock-arrow-down',
          iconClass: 'timer-type',
          email: true,
          sms: false,
          hasSms: true,
          threshold: { options: ['15m', '30m', '45m', '60m'], selected: '30m' },
          group: 'timer',
        },
        {
          id: 'long-timer',
          name: 'Long timer',
          desc: 'Timer running too long',
          icon: 'triangle-alert',
          iconClass: 'alert-type',
          email: false,
          sms: false,
          hasSms: true,
          threshold: { options: ['2h', '4h', '6h', '8h'], selected: '4h' },
          group: 'timer',
        },
        { id: 'divider-1', divider: true },
        {
          id: 'leave-approved',
          name: 'Leave approved',
          desc: 'Your leave request approved',
          icon: 'calendar-check',
          iconClass: 'leave-type',
          email: true,
          sms: false,
          hasSms: true,
          threshold: null,
          group: 'leave',
        },
        {
          id: 'leave-denied',
          name: 'Leave denied',
          desc: 'Your leave request denied',
          icon: 'calendar-x',
          iconClass: 'leave-type',
          email: true,
          sms: false,
          hasSms: true,
          threshold: null,
          group: 'leave',
        },
        {
          id: 'team-leave',
          name: 'Team leave',
          desc: 'Team member on leave',
          icon: 'users',
          iconClass: 'leave-type',
          email: false,
          sms: false,
          hasSms: false,
          threshold: null,
          group: 'leave',
        },
        { id: 'divider-2', divider: true },
        {
          id: 'weekly-report',
          name: 'Weekly report',
          desc: 'Weekly hours summary',
          icon: 'bar-chart-3',
          iconClass: 'summary-type',
          email: true,
          sms: false,
          hasSms: false,
          threshold: { options: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'], selected: 'Mon' },
          group: 'summary',
        },
      ];

      /* ── Build matrix ── */
      function buildMatrix() {
        const container = document.getElementById('typesMatrix');
        container.innerHTML = '';

        TYPES.forEach((type) => {
          if (type.divider) {
            const hr = document.createElement('hr');
            hr.className = 'type-divider';
            container.appendChild(hr);
            return;
          }

          const row = document.createElement('div');
          row.className = 'type-row';
          row.dataset.id = type.id;

          // SMS availability
          const smsDisabled = !smsEnabled || !type.hasSms;
          const smsCheckDisabled = smsDisabled ? 'disabled' : '';
          const smsChecked = type.sms && smsEnabled && type.hasSms ? 'checked' : '';

          // Email
          const emailDisabled = !emailEnabled ? 'disabled' : '';
          const emailChecked = type.email && emailEnabled ? 'checked' : '';

          // Threshold HTML
          let thresholdHtml = '';
          if (type.threshold) {
            const options = type.threshold.options
              .map(
                (opt) =>
                  `<option value="${opt}" ${opt === type.threshold.selected ? 'selected' : ''}>${opt}</option>`,
              )
              .join('');
            thresholdHtml = `
              <div class="threshold-cell">
                <select class="threshold-select" onchange="selectThreshold('${type.id}', this.value)">
                  ${options}
                </select>
              </div>
            `;
          } else {
            thresholdHtml = '<div class="threshold-cell"></div>';
          }

          row.innerHTML = `
            <div class="type-info">
              <div class="type-icon ${type.iconClass}"><i data-lucide="${type.icon}"></i></div>
              <div class="type-text">
                <div class="type-name">${type.name}</div>
                <div class="type-desc">${type.desc}</div>
              </div>
            </div>
            <div class="channel-check">
              <label class="mini-toggle">
                <input type="checkbox" ${emailChecked} ${emailDisabled}
                  onchange="updateType('${type.id}', 'email', this.checked)" />
                <span class="mini-toggle-track"></span>
              </label>
            </div>
            <div class="channel-check">
              ${
                type.hasSms
                  ? `<label class="mini-toggle">
                      <input type="checkbox" ${smsChecked} ${smsCheckDisabled}
                        onchange="updateType('${type.id}', 'sms', this.checked)" />
                      <span class="mini-toggle-track"></span>
                    </label>`
                  : `<span class="na-dash">&mdash;</span>`
              }
            </div>
            ${thresholdHtml}
          `;

          container.appendChild(row);
        });

        lucide.createIcons({ nodes: container.querySelectorAll('[data-lucide]') });
      }

      /* ── Type updates ── */
      function updateType(id, channel, checked) {
        const type = TYPES.find((t) => t.id === id);
        if (type) type[channel] = checked;
      }

      function selectThreshold(typeId, value) {
        const type = TYPES.find((t) => t.id === typeId);
        if (type && type.threshold) {
          type.threshold.selected = value;
        }
      }

      /* ── Channel toggles ── */
      function toggleChannel(channel) {
        if (channel === 'email') {
          emailEnabled = document.getElementById('emailMaster').checked;
          const card = document.getElementById('emailCard');
          card.classList.toggle('active', emailEnabled);
        } else {
          smsEnabled = document.getElementById('smsMaster').checked;
          const card = document.getElementById('smsCard');
          card.classList.toggle('active', smsEnabled);
        }
        // Rebuild matrix to update disabled states
        buildMatrix();
      }

      /* ── Phone flow ── */
      function showPhoneInput() {
        document.getElementById('smsAddBtn').style.display = 'none';
        document.getElementById('smsWarning').style.display = 'none';
        const flow = document.getElementById('phoneInputFlow');
        flow.classList.add('visible');
        document.getElementById('phoneInput').focus();
      }

      function cancelPhoneInput() {
        document.getElementById('phoneInputFlow').classList.remove('visible');
        document.getElementById('smsAddBtn').style.display = 'block';
        document.getElementById('smsWarning').style.display = 'flex';
        document.getElementById('phoneInput').value = '';
      }

      function savePhone() {
        const input = document.getElementById('phoneInput').value.trim();
        if (!input) return;

        phoneAdded = true;

        // Show the "has phone" state
        document.getElementById('smsNoPhone').style.display = 'none';
        document.getElementById('smsHasPhone').style.display = 'flex';

        // Enable the SMS master toggle
        const smsMaster = document.getElementById('smsMaster');
        smsMaster.disabled = false;

        // Re-init icons in the revealed element
        lucide.createIcons({
          nodes: document.getElementById('smsHasPhone').querySelectorAll('[data-lucide]'),
        });
      }

      function sendTest() {
        const link = document.querySelector('.send-test-link');
        const orig = link.textContent;
        link.textContent = 'Sent!';
        link.style.opacity = '0.5';
        setTimeout(() => {
          link.textContent = orig;
          link.style.opacity = '1';
        }, 1500);
      }

      /* ── Theme switcher ── */
      function setTheme(t) {
        document.getElementById('app').setAttribute('data-theme', t);
        document.querySelectorAll('.theme-nav button').forEach((b) => b.classList.remove('active'));
        event.target.classList.add('active');
      }

      /* ── Init ── */
      buildMatrix();
      lucide.createIcons();
    </script>
  </body>
</html>
