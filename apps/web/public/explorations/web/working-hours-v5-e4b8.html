<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Working Hours — V5 Split View</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../themes.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #0a0a0a;
        color: #ccc;
        font-family: 'Inter', system-ui, sans-serif;
        padding: 16px;
        font-size: 14px;
      }

      .page-header {
        text-align: center;
        margin-bottom: 8px;
      }
      .page-header h1 {
        font-family: 'Oxanium', sans-serif;
        font-size: 11px;
        font-weight: 400;
        letter-spacing: 5px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.3);
      }
      .page-header p {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.15);
        margin-top: 4px;
      }

      .switcher-row {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-bottom: 12px;
        flex-wrap: wrap;
        align-items: center;
      }
      .switcher-label {
        font-size: 9px;
        letter-spacing: 1px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.2);
      }
      .switcher-group {
        display: flex;
        gap: 4px;
      }
      .theme-nav {
        display: contents;
      }
      .switcher-group button {
        font-family: 'Inter', sans-serif;
        font-size: 10px;
        padding: 4px 10px;
        border-radius: 4px;
        border: 1px solid #222;
        background: #161616;
        color: rgba(255, 255, 255, 0.35);
        cursor: pointer;
        transition: all 0.15s;
      }
      .switcher-group button:hover {
        border-color: #444;
      }
      .switcher-group button.active {
        background: #333;
        border-color: #555;
        color: rgba(255, 255, 255, 0.8);
      }

      /* ── App shell ── */
      .app-shell {
        display: flex;
        max-width: 1280px;
        margin: 0 auto;
        min-height: 720px;
        background: hsl(var(--background));
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid hsl(var(--border));
      }

      /* ── Sidebar ── */
      .sidebar {
        width: 220px;
        flex-shrink: 0;
        background: hsl(var(--sidebar-background));
        border-right: 1px solid hsl(var(--sidebar-border));
        display: flex;
        flex-direction: column;
        height: 720px;
        padding: 20px 12px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 10px;
        margin-bottom: 20px;
      }
      .logo-icon {
        width: 18px;
        height: 22px;
        color: hsl(var(--primary));
      }
      .logo-text {
        font-family: 'Oxanium', sans-serif;
        font-size: 15px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 3px;
      }

      .section-label {
        padding: 8px 10px 4px;
        font-family: 'Oxanium', sans-serif;
        text-transform: uppercase;
        color: hsl(var(--muted-foreground));
        opacity: 0.5;
        font-size: 10px;
        letter-spacing: 2px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 6px;
        color: hsl(var(--muted-foreground));
        font-size: 13px;
        cursor: pointer;
        transition: all 0.15s;
        text-decoration: none;
      }
      .nav-item:hover {
        background: hsl(var(--sidebar-accent));
        color: hsl(var(--sidebar-accent-foreground));
      }
      .nav-item i {
        width: 16px;
        height: 16px;
      }

      .sidebar-spacer {
        flex: 1;
      }

      .user-block {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.15s;
      }
      .user-block:hover {
        background: hsl(var(--muted) / 0.5);
      }
      .avatar {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: hsl(var(--t-avatar-bg));
        color: hsl(var(--t-avatar-text));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        flex-shrink: 0;
      }
      .user-info {
        flex: 1;
        min-width: 0;
      }
      .user-name {
        font-size: 12px;
        font-weight: 500;
        color: hsl(var(--sidebar-foreground));
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .user-org {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        margin-top: 1px;
        display: flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }
      .user-org .badge {
        font-family: 'Oxanium', sans-serif;
        font-size: 9px;
        font-weight: 600;
        letter-spacing: 0.5px;
        padding: 1px 5px;
        border-radius: 4px;
        background: hsl(var(--primary) / 0.12);
        color: hsl(var(--primary));
      }
      .user-chevrons {
        color: hsl(var(--muted-foreground));
        opacity: 0.5;
        flex-shrink: 0;
      }
      .user-chevrons i {
        width: 14px;
        height: 14px;
      }

      /* ── Main content ── */
      .main {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
      }

      .main-header {
        margin-bottom: 20px;
      }
      .main-title {
        font-family: 'Oxanium', sans-serif;
        font-size: 18px;
        font-weight: 600;
        color: hsl(var(--foreground));
      }
      .main-subtitle {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
        margin-top: 2px;
      }

      /* ── Tabs ── */
      .tabs {
        display: flex;
        gap: 0;
        border-bottom: 1px solid hsl(var(--border));
        margin-bottom: 28px;
        overflow-x: auto;
      }
      .tab {
        font-family: 'Inter', sans-serif;
        font-size: 13px;
        font-weight: 500;
        color: hsl(var(--muted-foreground));
        padding: 10px 16px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.15s;
        white-space: nowrap;
        background: none;
        border-top: none;
        border-left: none;
        border-right: none;
      }
      .tab:hover {
        color: hsl(var(--foreground));
      }
      .tab.active {
        color: hsl(var(--primary));
        border-bottom-color: hsl(var(--primary));
        font-weight: 600;
      }

      /* ── V5 content ── */
      .content-area {
        max-width: 900px;
      }

      .content-header {
        margin-bottom: 20px;
      }
      .content-header h2 {
        font-family: 'Oxanium', sans-serif;
        font-size: 16px;
        font-weight: 600;
        color: hsl(var(--foreground));
      }
      .content-header p {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
        margin-top: 3px;
      }

      /* ── Split layout ── */
      .split-view {
        display: flex;
        gap: 24px;
      }

      .left-panel {
        flex: 0 0 58%;
      }

      .right-panel {
        flex: 1;
        background: hsl(var(--t-surface));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        padding: 20px;
      }

      .panel-title {
        font-family: 'Oxanium', sans-serif;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 2px;
        text-transform: uppercase;
        color: hsl(var(--muted-foreground));
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .panel-title i {
        width: 14px;
        height: 14px;
      }

      /* ── Schedule grid ── */
      .schedule-grid {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .schedule-row {
        display: grid;
        grid-template-columns: 42px 1fr 1fr 52px 36px;
        align-items: center;
        gap: 8px;
        padding: 6px 0;
        border-radius: 6px;
        transition: background 0.12s;
      }
      .schedule-row:hover {
        background: hsl(var(--muted) / 0.3);
      }
      .schedule-row.day-off {
        opacity: 0.4;
      }
      .schedule-row.day-off:hover {
        opacity: 0.6;
      }

      .day-label {
        font-family: 'Oxanium', sans-serif;
        font-size: 12px;
        font-weight: 600;
        color: hsl(var(--foreground));
        letter-spacing: 0.5px;
      }
      .schedule-row.day-off .day-label {
        color: hsl(var(--muted-foreground));
      }

      .time-input {
        font-family: 'Oxanium', sans-serif;
        font-size: 13px;
        font-weight: 500;
        color: hsl(var(--foreground));
        background: hsl(var(--muted));
        border: 1px solid hsl(var(--border));
        border-radius: 6px;
        padding: 6px 8px;
        text-align: center;
        outline: none;
        transition:
          border-color 0.15s,
          box-shadow 0.15s;
        width: 100%;
      }
      .time-input:focus {
        border-color: hsl(var(--primary));
        box-shadow: 0 0 0 2px hsl(var(--primary) / 0.15);
      }
      .time-input:disabled {
        color: hsl(var(--muted-foreground));
        opacity: 0.5;
        cursor: not-allowed;
      }

      .hours-badge {
        font-family: 'Oxanium', sans-serif;
        font-size: 11px;
        font-weight: 600;
        color: hsl(var(--primary));
        text-align: right;
        white-space: nowrap;
      }
      .schedule-row.day-off .hours-badge {
        color: hsl(var(--muted-foreground));
      }

      .toggle-btn {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        border: 1px solid hsl(var(--border));
        background: hsl(var(--muted));
        color: hsl(var(--muted-foreground));
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.15s;
        padding: 0;
      }
      .toggle-btn:hover {
        border-color: hsl(var(--primary));
        color: hsl(var(--primary));
      }
      .toggle-btn.active {
        background: hsl(var(--primary) / 0.12);
        border-color: hsl(var(--primary) / 0.3);
        color: hsl(var(--primary));
      }
      .toggle-btn i {
        width: 14px;
        height: 14px;
      }

      /* ── Total bar ── */
      .total-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 16px;
        padding: 12px 14px;
        background: hsl(var(--t-stat-bg));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
      }
      .total-label {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .total-label i {
        width: 14px;
        height: 14px;
      }
      .total-value {
        font-family: 'Oxanium', sans-serif;
        font-size: 18px;
        font-weight: 700;
        color: hsl(var(--foreground));
      }
      .total-value span {
        font-size: 12px;
        font-weight: 400;
        color: hsl(var(--muted-foreground));
        margin-left: 2px;
      }

      /* ── Effective since ── */
      .effective-since {
        margin-top: 10px;
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .effective-since i {
        width: 12px;
        height: 12px;
        opacity: 0.6;
      }

      /* ── Right panel — Team overlap ── */
      .overlap-header {
        margin-bottom: 16px;
      }
      .overlap-day-title {
        font-family: 'Oxanium', sans-serif;
        font-size: 14px;
        font-weight: 600;
        color: hsl(var(--foreground));
      }
      .overlap-day-subtitle {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        margin-top: 2px;
      }

      .time-axis {
        display: flex;
        justify-content: space-between;
        padding: 0 0 6px;
        position: relative;
      }
      .time-axis::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: hsl(var(--border));
      }
      .time-tick {
        font-family: 'Oxanium', sans-serif;
        font-size: 9px;
        color: hsl(var(--muted-foreground));
        opacity: 0.6;
        width: 0;
        text-align: center;
      }

      .team-bars {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 10px;
      }

      .team-member-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .member-name {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
        width: 48px;
        flex-shrink: 0;
        text-align: right;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .member-name.is-you {
        color: hsl(var(--primary));
        font-weight: 600;
      }
      .bar-track {
        flex: 1;
        height: 22px;
        position: relative;
        border-radius: 4px;
      }

      /* Grid lines */
      .bar-track::before {
        content: '';
        position: absolute;
        inset: 0;
        background: repeating-linear-gradient(
          to right,
          hsl(var(--border) / 0.3) 0px,
          hsl(var(--border) / 0.3) 1px,
          transparent 1px,
          transparent calc(100% / 13)
        );
        border-radius: 4px;
      }

      .bar-fill {
        position: absolute;
        top: 2px;
        bottom: 2px;
        border-radius: 3px;
        background: hsl(var(--muted));
        transition:
          left 0.3s ease,
          width 0.3s ease;
      }
      .bar-fill.is-you {
        background: hsl(var(--primary));
        opacity: 0.85;
      }
      .bar-fill .bar-time-label {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: 'Oxanium', sans-serif;
        font-size: 9px;
        font-weight: 600;
        color: hsl(var(--primary-foreground));
        white-space: nowrap;
      }
      .bar-fill.is-you .bar-time-label {
        display: block;
      }

      /* Overlap zone highlight */
      .overlap-zone {
        position: absolute;
        top: -4px;
        bottom: -4px;
        background: hsl(var(--primary) / 0.06);
        border-left: 1px dashed hsl(var(--primary) / 0.25);
        border-right: 1px dashed hsl(var(--primary) / 0.25);
        pointer-events: none;
        transition:
          left 0.3s ease,
          width 0.3s ease;
        z-index: 0;
      }

      /* Overlap stat */
      .overlap-stat {
        margin-top: 16px;
        padding: 10px 12px;
        background: hsl(var(--t-stat-bg));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .overlap-stat i {
        width: 16px;
        height: 16px;
        color: hsl(var(--primary));
        flex-shrink: 0;
      }
      .overlap-stat-text {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
      }
      .overlap-stat-text strong {
        color: hsl(var(--foreground));
        font-weight: 600;
      }
      .overlap-stat-count {
        margin-left: auto;
        font-family: 'Oxanium', sans-serif;
        font-size: 13px;
        font-weight: 700;
        color: hsl(var(--primary));
        white-space: nowrap;
      }

      /* ── Responsive ── */
      @media (max-width: 900px) {
        .split-view {
          flex-direction: column;
        }
        .left-panel {
          flex: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <h1>Ternity</h1>
      <p>V5 — Split View: Working Hours settings with team overlap preview</p>
    </div>
    <div class="switcher-row">
      <span class="switcher-label">Theme</span>
      <div class="switcher-group">
        <div class="theme-nav">
          <button class="active" onclick="setTheme('ternity-dark')">Ternity Dark</button>
          <button onclick="setTheme('ternity-light')">Ternity Light</button>
          <button onclick="setTheme('midnight')">Midnight</button>
          <button onclick="setTheme('warm-sand')">Warm Sand</button>
          <button onclick="setTheme('carbon')">Carbon</button>
          <button onclick="setTheme('high-contrast')">High Contrast</button>
        </div>
      </div>
    </div>

    <div class="app-shell" id="app" data-theme="ternity-dark">
      <!-- ── Sidebar ── -->
      <aside class="sidebar">
        <div class="logo">
          <i data-lucide="hourglass" class="logo-icon"></i>
          <span class="logo-text">Ternity</span>
        </div>

        <div class="section-label">Tracking</div>
        <a class="nav-item"><i data-lucide="sun"></i> My Day</a>
        <a class="nav-item"><i data-lucide="list"></i> Entries</a>
        <a class="nav-item"><i data-lucide="calendar"></i> Calendar</a>
        <a class="nav-item"><i data-lucide="palm-tree"></i> Leave</a>
        <a class="nav-item"><i data-lucide="bar-chart-3"></i> Reports</a>

        <div class="sidebar-spacer"></div>

        <div class="user-block">
          <div class="avatar">PR</div>
          <div class="user-info">
            <div class="user-name">Przemyslaw R.</div>
            <div class="user-org">
              Netbulls
              <span class="badge">Admin</span>
            </div>
          </div>
          <div class="user-chevrons">
            <i data-lucide="chevrons-up-down"></i>
          </div>
        </div>
      </aside>

      <!-- ── Main ── -->
      <main class="main">
        <div class="main-header">
          <h1 class="main-title">Settings</h1>
          <p class="main-subtitle">Manage your account and application preferences</p>
        </div>

        <div class="tabs">
          <button class="tab">General</button>
          <button class="tab">Appearance</button>
          <button class="tab">Integrations</button>
          <button class="tab">Downloads</button>
          <button class="tab">Tags</button>
          <button class="tab active">Working Hours</button>
          <button class="tab">Notifications</button>
        </div>

        <div class="content-area">
          <div class="content-header">
            <h2>Weekly Schedule</h2>
            <p>See how your schedule overlaps with the team</p>
          </div>

          <div class="split-view">
            <!-- LEFT: My Schedule -->
            <div class="left-panel">
              <div class="panel-title"><i data-lucide="user"></i> My Schedule</div>
              <div class="schedule-grid" id="scheduleGrid">
                <!-- Rows injected by JS -->
              </div>
              <div class="total-bar">
                <div class="total-label"><i data-lucide="sigma"></i> Weekly total</div>
                <div class="total-value" id="weeklyTotal">40<span>h</span></div>
              </div>
              <div class="effective-since">
                <i data-lucide="calendar-clock"></i>
                Effective since 3 Feb 2026
              </div>
            </div>

            <!-- RIGHT: Team Overlap -->
            <div class="right-panel">
              <div class="panel-title"><i data-lucide="users"></i> Team Overlap</div>

              <div class="overlap-header">
                <div class="overlap-day-title" id="overlapDayTitle">Monday</div>
                <div class="overlap-day-subtitle">Today's overlap</div>
              </div>

              <div class="time-axis" id="timeAxis">
                <!-- Ticks injected by JS -->
              </div>

              <div class="team-bars" id="teamBars">
                <!-- Bars injected by JS -->
              </div>

              <div class="overlap-stat" id="overlapStat">
                <i data-lucide="layers"></i>
                <div>
                  <div class="overlap-stat-text">
                    Peak overlap: <strong id="overlapRange">10:00 – 15:00</strong>
                  </div>
                </div>
                <div class="overlap-stat-count" id="overlapCount">4 people</div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      /* ── Data ── */
      const AXIS_START = 7;
      const AXIS_END = 20;
      const AXIS_SPAN = AXIS_END - AXIS_START;

      const DAYS = [
        { key: 'mon', label: 'Mon', start: '09:00', end: '17:00', off: false },
        { key: 'tue', label: 'Tue', start: '09:00', end: '17:00', off: false },
        { key: 'wed', label: 'Wed', start: '09:00', end: '17:00', off: false },
        { key: 'thu', label: 'Thu', start: '09:00', end: '17:00', off: false },
        { key: 'fri', label: 'Fri', start: '09:00', end: '17:00', off: false },
        { key: 'sat', label: 'Sat', start: '09:00', end: '17:00', off: true },
        { key: 'sun', label: 'Sun', start: '09:00', end: '17:00', off: true },
      ];

      const TEAM = [
        { name: 'Elena', start: 9, end: 17 },
        { name: 'James', start: 9, end: 17 },
        { name: 'Nora', start: 10, end: 18 },
        { name: 'Leo', start: 9, end: 17 },
      ];

      /* ── Helpers ── */
      function parseTime(str) {
        const [h, m] = str.split(':').map(Number);
        return h + m / 60;
      }

      function hoursFromTimes(start, end) {
        const diff = parseTime(end) - parseTime(start);
        return Math.max(0, Math.round(diff * 10) / 10);
      }

      function toPercent(hour) {
        return ((hour - AXIS_START) / AXIS_SPAN) * 100;
      }

      function pad(n) {
        return String(n).padStart(2, '0');
      }

      function formatHour(h) {
        const hrs = Math.floor(h);
        const mins = Math.round((h - hrs) * 60);
        return `${pad(hrs)}:${pad(mins)}`;
      }

      /* ── Build schedule grid ── */
      function buildScheduleGrid() {
        const grid = document.getElementById('scheduleGrid');
        grid.innerHTML = '';
        DAYS.forEach((day, i) => {
          const row = document.createElement('div');
          row.className = 'schedule-row' + (day.off ? ' day-off' : '');
          row.dataset.index = i;

          row.innerHTML = `
            <div class="day-label">${day.label}</div>
            <input type="time" class="time-input start-input" value="${day.start}" ${day.off ? 'disabled' : ''} />
            <input type="time" class="time-input end-input" value="${day.end}" ${day.off ? 'disabled' : ''} />
            <div class="hours-badge">${day.off ? 'Off' : hoursFromTimes(day.start, day.end) + 'h'}</div>
            <button class="toggle-btn ${day.off ? '' : 'active'}" title="${day.off ? 'Enable' : 'Day off'}">
              <i data-lucide="${day.off ? 'moon' : 'sun'}"></i>
            </button>
          `;

          const startInput = row.querySelector('.start-input');
          const endInput = row.querySelector('.end-input');
          const toggle = row.querySelector('.toggle-btn');

          startInput.addEventListener('change', () => {
            day.start = startInput.value;
            updateRow(row, day);
            recalc();
          });
          endInput.addEventListener('change', () => {
            day.end = endInput.value;
            updateRow(row, day);
            recalc();
          });
          toggle.addEventListener('click', () => {
            day.off = !day.off;
            updateRow(row, day);
            recalc();
          });

          grid.appendChild(row);
        });
        lucide.createIcons({ nodes: grid.querySelectorAll('[data-lucide]') });
      }

      function updateRow(row, day) {
        const startInput = row.querySelector('.start-input');
        const endInput = row.querySelector('.end-input');
        const badge = row.querySelector('.hours-badge');
        const toggle = row.querySelector('.toggle-btn');

        startInput.disabled = day.off;
        endInput.disabled = day.off;

        if (day.off) {
          row.classList.add('day-off');
          badge.textContent = 'Off';
          toggle.classList.remove('active');
        } else {
          row.classList.remove('day-off');
          badge.textContent = hoursFromTimes(day.start, day.end) + 'h';
          toggle.classList.add('active');
        }

        // Re-render icon
        toggle.innerHTML = `<i data-lucide="${day.off ? 'moon' : 'sun'}"></i>`;
        lucide.createIcons({ nodes: toggle.querySelectorAll('[data-lucide]') });
      }

      /* ── Recalculate totals + overlap ── */
      function recalc() {
        // Weekly total
        let total = 0;
        DAYS.forEach((d) => {
          if (!d.off) total += hoursFromTimes(d.start, d.end);
        });
        document.getElementById('weeklyTotal').innerHTML =
          `${Math.round(total * 10) / 10}<span>h</span>`;

        // Update Monday bar in team overlap (index 0)
        updateTeamOverlap();
      }

      /* ── Build time axis ── */
      function buildTimeAxis() {
        const axis = document.getElementById('timeAxis');
        for (let h = AXIS_START; h <= AXIS_END; h++) {
          const tick = document.createElement('div');
          tick.className = 'time-tick';
          tick.textContent = `${h}:00`;
          axis.appendChild(tick);
        }
      }

      /* ── Build team bars ── */
      function buildTeamBars() {
        const container = document.getElementById('teamBars');
        container.innerHTML = '';

        // Team members
        TEAM.forEach((member) => {
          container.appendChild(createBarRow(member.name, member.start, member.end, false));
        });

        // "You" bar (from Monday data)
        const mon = DAYS[0];
        const youStart = mon.off ? 0 : parseTime(mon.start);
        const youEnd = mon.off ? 0 : parseTime(mon.end);
        container.appendChild(createBarRow('You', youStart, youEnd, true));

        addOverlapZones();
      }

      function createBarRow(name, startH, endH, isYou) {
        const row = document.createElement('div');
        row.className = 'team-member-row';
        row.dataset.name = name;

        const left = Math.max(0, toPercent(startH));
        const right = Math.min(100, toPercent(endH));
        const width = Math.max(0, right - left);

        row.innerHTML = `
          <div class="member-name ${isYou ? 'is-you' : ''}">${name}</div>
          <div class="bar-track">
            <div class="bar-fill ${isYou ? 'is-you' : ''}" style="left: ${left}%; width: ${width}%;">
              ${isYou ? `<span class="bar-time-label">${formatHour(startH)} – ${formatHour(endH)}</span>` : ''}
            </div>
          </div>
        `;
        return row;
      }

      function addOverlapZones() {
        const mon = DAYS[0];
        const youStart = mon.off ? null : parseTime(mon.start);
        const youEnd = mon.off ? null : parseTime(mon.end);

        const schedules = TEAM.map((m) => ({ start: m.start, end: m.end }));
        if (youStart !== null && youEnd !== null) {
          schedules.push({ start: youStart, end: youEnd });
        }

        // Sweep line to find peak overlap
        const events = [];
        schedules.forEach((s) => {
          events.push({ time: s.start, type: 1 });
          events.push({ time: s.end, type: -1 });
        });
        events.sort((a, b) => a.time - b.time || a.type - b.type);

        let count = 0;
        let maxCount = 0;

        for (let i = 0; i < events.length; i++) {
          count += events[i].type;
          if (count > maxCount) {
            maxCount = count;
          }
        }

        // Find the contiguous window at maxCount
        count = 0;
        let inPeak = false;
        let peakStart = 0;
        let peakEnd = 0;
        for (let i = 0; i < events.length; i++) {
          count += events[i].type;
          if (count >= maxCount && !inPeak) {
            peakStart = events[i].time;
            inPeak = true;
          }
          if (count < maxCount && inPeak) {
            peakEnd = events[i].time;
            inPeak = false;
          }
        }
        if (inPeak) peakEnd = AXIS_END;

        // Update overlap stat
        document.getElementById('overlapRange').textContent =
          `${formatHour(peakStart)} – ${formatHour(peakEnd)}`;
        document.getElementById('overlapCount').textContent =
          `${maxCount} ${maxCount === 1 ? 'person' : 'people'}`;

        // Add overlap zone indicator to each bar track
        const tracks = document.querySelectorAll('.bar-track');
        tracks.forEach((track) => {
          track.querySelectorAll('.overlap-zone').forEach((z) => z.remove());

          const zone = document.createElement('div');
          zone.className = 'overlap-zone';
          zone.style.left = toPercent(peakStart) + '%';
          zone.style.width = toPercent(peakEnd) - toPercent(peakStart) + '%';
          track.insertBefore(zone, track.firstChild);
        });
      }

      function updateTeamOverlap() {
        const container = document.getElementById('teamBars');
        const youRow = container.querySelector('[data-name="You"]');
        if (!youRow) return;

        const mon = DAYS[0];
        const youStart = mon.off ? 0 : parseTime(mon.start);
        const youEnd = mon.off ? 0 : parseTime(mon.end);

        const left = Math.max(0, toPercent(youStart));
        const right = Math.min(100, toPercent(youEnd));
        const width = mon.off ? 0 : Math.max(0, right - left);

        const fill = youRow.querySelector('.bar-fill');
        fill.style.left = left + '%';
        fill.style.width = width + '%';

        const label = fill.querySelector('.bar-time-label');
        if (label) {
          label.textContent = mon.off ? 'Off' : `${formatHour(youStart)} – ${formatHour(youEnd)}`;
        }

        addOverlapZones();
      }

      /* ── Theme switcher ── */
      function setTheme(t) {
        document.getElementById('app').setAttribute('data-theme', t);
        document.querySelectorAll('.theme-nav button').forEach((b) => b.classList.remove('active'));
        event.target.classList.add('active');
      }

      /* ── Init ── */
      buildScheduleGrid();
      buildTimeAxis();
      buildTeamBars();
      recalc();
      lucide.createIcons();
    </script>
  </body>
</html>
